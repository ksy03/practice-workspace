import{t as Ye}from"./chunks/chunk-2KAW52SRjs.js";import{a as zt}from"./chunks/chunk-SY4NTXA7js.js";import{a as q,b as wt,e as Tt,f as vt,h as rn}from"./chunks/chunk-XJ5VWOPVjs.js";var fo={value:()=>{}};function on(){for(var r=0,t=arguments.length,e={},n;r<t;++r){if(!(n=arguments[r]+"")||n in e||/[\s.]/.test(n))throw new Error("illegal type: "+n);e[n]=[]}return new $e(e)}function $e(r){this._=r}function po(r,t){return r.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}$e.prototype=on.prototype={constructor:$e,on:function(r,t){var e=this._,n=po(r+"",e),i,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((i=(r=n[o]).type)&&(i=go(e[i],r.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(r=n[o]).type)e[i]=nn(e[i],r.name,t);else if(t==null)for(i in e)e[i]=nn(e[i],r.name,null);return this},copy:function(){var r={},t=this._;for(var e in t)r[e]=t[e].slice();return new $e(r)},call:function(r,t){if((i=arguments.length-2)>0)for(var e=new Array(i),n=0,i,o;n<i;++n)e[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(o=this._[r],n=0,i=o.length;n<i;++n)o[n].value.apply(t,e)},apply:function(r,t,e){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],i=0,o=n.length;i<o;++i)n[i].value.apply(t,e)}};function go(r,t){for(var e=0,n=r.length,i;e<n;++e)if((i=r[e]).name===t)return i.value}function nn(r,t,e){for(var n=0,i=r.length;n<i;++n)if(r[n].name===t){r[n]=fo,r=r.slice(0,n).concat(r.slice(n+1));break}return e!=null&&r.push({name:t,value:e}),r}var Ot=on;var Fe="http://www.w3.org/1999/xhtml",jr={svg:"http://www.w3.org/2000/svg",xhtml:Fe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ht(r){var t=r+="",e=t.indexOf(":");return e>=0&&(t=r.slice(0,e))!=="xmlns"&&(r=r.slice(e+1)),jr.hasOwnProperty(t)?{space:jr[t],local:r}:r}function mo(r){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Fe&&t.documentElement.namespaceURI===Fe?t.createElement(r):t.createElementNS(e,r)}}function yo(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Be(r){var t=ht(r);return(t.local?yo:mo)(t)}function xo(){}function St(r){return r==null?xo:function(){return this.querySelector(r)}}function sn(r){typeof r!="function"&&(r=St(r));for(var t=this._groups,e=t.length,n=new Array(e),i=0;i<e;++i)for(var o=t[i],s=o.length,a=n[i]=new Array(s),l,c,h=0;h<s;++h)(l=o[h])&&(c=r.call(l,l.__data__,h,o))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new E(n,this._parents)}function Ve(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function bo(){return[]}function Ft(r){return r==null?bo:function(){return this.querySelectorAll(r)}}function _o(r){return function(){var t=r.apply(this,arguments);return t==null?[]:Ve(t)}}function an(r){typeof r=="function"?r=_o(r):r=Ft(r);for(var t=this._groups,e=t.length,n=[],i=[],o=0;o<e;++o)for(var s=t[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(r.call(l,l.__data__,c,s)),i.push(l));return new E(n,i)}function Bt(r){return function(){return this.matches(r)}}function We(r){return function(t){return t.matches(r)}}var wo=Array.prototype.find;function vo(r){return function(){return wo.call(this.children,r)}}function Oo(){return this.firstElementChild}function ln(r){return this.select(r==null?Oo:vo(typeof r=="function"?r:We(r)))}var So=Array.prototype.filter;function Co(){return this.children}function ko(r){return function(){return So.call(this.children,r)}}function cn(r){return this.selectAll(r==null?Co:ko(typeof r=="function"?r:We(r)))}function hn(r){typeof r!="function"&&(r=Bt(r));for(var t=this._groups,e=t.length,n=new Array(e),i=0;i<e;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&r.call(l,l.__data__,c,o)&&a.push(l);return new E(n,this._parents)}function Ue(r){return new Array(r.length)}function dn(){return new E(this._enter||this._groups.map(Ue),this._parents)}function Vt(r,t){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=t}Vt.prototype={constructor:Vt,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,t){return this._parent.insertBefore(r,t)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function un(r){return function(){return r}}function jo(r,t,e,n,i,o){for(var s=0,a,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],n[s]=a):e[s]=new Vt(r,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function Mo(r,t,e,n,i,o,s){var a,l,c=new Map,h=t.length,p=o.length,f=new Array(h),m;for(a=0;a<h;++a)(l=t[a])&&(f[a]=m=s.call(l,l.__data__,a,t)+"",c.has(m)?i[a]=l:c.set(m,l));for(a=0;a<p;++a)m=s.call(r,o[a],a,o)+"",(l=c.get(m))?(n[a]=l,l.__data__=o[a],c.delete(m)):e[a]=new Vt(r,o[a]);for(a=0;a<h;++a)(l=t[a])&&c.get(f[a])===l&&(i[a]=l)}function Eo(r){return r.__data__}function fn(r,t){if(!arguments.length)return Array.from(this,Eo);var e=t?Mo:jo,n=this._parents,i=this._groups;typeof r!="function"&&(r=un(r));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var h=n[c],p=i[c],f=p.length,m=Ve(r.call(h,h&&h.__data__,c,n)),S=m.length,k=a[c]=new Array(S),T=s[c]=new Array(S),x=l[c]=new Array(f);e(h,p,k,T,x,m,t);for(var D=0,z=0,g,O;D<S;++D)if(g=k[D]){for(D>=z&&(z=D+1);!(O=T[z])&&++z<S;);g._next=O||null}}return s=new E(s,n),s._enter=a,s._exit=l,s}function pn(){return new E(this._exit||this._groups.map(Ue),this._parents)}function gn(r,t,e){var n=this.enter(),i=this,o=this.exit();return n=typeof r=="function"?r(n):n.append(r+""),t!=null&&(i=t(i)),e==null?o.remove():e(o),n&&i?n.merge(i).order():i}function mn(r){if(!(r instanceof E))throw new Error("invalid merge");for(var t=this._groups,e=r._groups,n=t.length,i=e.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=t[a],c=e[a],h=l.length,p=s[a]=new Array(h),f,m=0;m<h;++m)(f=l[m]||c[m])&&(p[m]=f);for(;a<n;++a)s[a]=t[a];return new E(s,this._parents)}function yn(){for(var r=this._groups,t=-1,e=r.length;++t<e;)for(var n=r[t],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function xn(r){r||(r=Io);function t(p,f){return p&&f?r(p.__data__,f.__data__):!p-!f}for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o){for(var s=e[o],a=s.length,l=i[o]=new Array(a),c,h=0;h<a;++h)(c=s[h])&&(l[h]=c);l.sort(t)}return new E(i,this._parents).order()}function Io(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function bn(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function _n(){return Array.from(this)}function wn(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var n=r[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function vn(){let r=0;for(let t of this)++r;return r}function On(){return!this.node()}function Sn(r){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],o=0,s=i.length,a;o<s;++o)(a=i[o])&&r.call(a,a.__data__,o,i);return this}function To(r){return function(){this.removeAttribute(r)}}function zo(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Ao(r,t){return function(){this.setAttribute(r,t)}}function Do(r,t){return function(){this.setAttributeNS(r.space,r.local,t)}}function No(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(r):this.setAttribute(r,e)}}function Po(r,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,e)}}function Cn(r,t){var e=ht(r);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((t==null?e.local?zo:To:typeof t=="function"?e.local?Po:No:e.local?Do:Ao)(e,t))}function qe(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function Ro(r){return function(){this.style.removeProperty(r)}}function Lo(r,t,e){return function(){this.style.setProperty(r,t,e)}}function Xo(r,t,e){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,e)}}function kn(r,t,e){return arguments.length>1?this.each((t==null?Ro:typeof t=="function"?Xo:Lo)(r,t,e==null?"":e)):gt(this.node(),r)}function gt(r,t){return r.style.getPropertyValue(t)||qe(r).getComputedStyle(r,null).getPropertyValue(t)}function Ho(r){return function(){delete this[r]}}function Yo(r,t){return function(){this[r]=t}}function $o(r,t){return function(){var e=t.apply(this,arguments);e==null?delete this[r]:this[r]=e}}function jn(r,t){return arguments.length>1?this.each((t==null?Ho:typeof t=="function"?$o:Yo)(r,t)):this.node()[r]}function Mn(r){return r.trim().split(/^|\s+/)}function Mr(r){return r.classList||new En(r)}function En(r){this._node=r,this._names=Mn(r.getAttribute("class")||"")}En.prototype={add:function(r){var t=this._names.indexOf(r);t<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var t=this._names.indexOf(r);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function In(r,t){for(var e=Mr(r),n=-1,i=t.length;++n<i;)e.add(t[n])}function Tn(r,t){for(var e=Mr(r),n=-1,i=t.length;++n<i;)e.remove(t[n])}function Fo(r){return function(){In(this,r)}}function Bo(r){return function(){Tn(this,r)}}function Vo(r,t){return function(){(t.apply(this,arguments)?In:Tn)(this,r)}}function zn(r,t){var e=Mn(r+"");if(arguments.length<2){for(var n=Mr(this.node()),i=-1,o=e.length;++i<o;)if(!n.contains(e[i]))return!1;return!0}return this.each((typeof t=="function"?Vo:t?Fo:Bo)(e,t))}function Wo(){this.textContent=""}function Uo(r){return function(){this.textContent=r}}function qo(r){return function(){var t=r.apply(this,arguments);this.textContent=t==null?"":t}}function An(r){return arguments.length?this.each(r==null?Wo:(typeof r=="function"?qo:Uo)(r)):this.node().textContent}function Go(){this.innerHTML=""}function Ko(r){return function(){this.innerHTML=r}}function Zo(r){return function(){var t=r.apply(this,arguments);this.innerHTML=t==null?"":t}}function Dn(r){return arguments.length?this.each(r==null?Go:(typeof r=="function"?Zo:Ko)(r)):this.node().innerHTML}function Jo(){this.nextSibling&&this.parentNode.appendChild(this)}function Nn(){return this.each(Jo)}function Qo(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Pn(){return this.each(Qo)}function Rn(r){var t=typeof r=="function"?r:Be(r);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function ts(){return null}function Ln(r,t){var e=typeof r=="function"?r:Be(r),n=t==null?ts:typeof t=="function"?t:St(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function es(){var r=this.parentNode;r&&r.removeChild(this)}function Xn(){return this.each(es)}function rs(){var r=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function ns(){var r=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(r,this.nextSibling):r}function Hn(r){return this.select(r?ns:rs)}function Yn(r){return arguments.length?this.property("__data__",r):this.node().__data__}function is(r){return function(t){r.call(this,t,this.__data__)}}function os(r){return r.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function ss(r){return function(){var t=this.__on;if(!!t){for(var e=0,n=-1,i=t.length,o;e<i;++e)o=t[e],(!r.type||o.type===r.type)&&o.name===r.name?this.removeEventListener(o.type,o.listener,o.options):t[++n]=o;++n?t.length=n:delete this.__on}}}function as(r,t,e){return function(){var n=this.__on,i,o=is(t);if(n){for(var s=0,a=n.length;s<a;++s)if((i=n[s]).type===r.type&&i.name===r.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=e),i.value=t;return}}this.addEventListener(r.type,o,e),i={type:r.type,name:r.name,value:t,listener:o,options:e},n?n.push(i):this.__on=[i]}}function $n(r,t,e){var n=os(r+""),i,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(i=0,h=a[l];i<o;++i)if((s=n[i]).type===h.type&&s.name===h.name)return h.value}return}for(a=t?as:ss,i=0;i<o;++i)this.each(a(n[i],t,e));return this}function Fn(r,t,e){var n=qe(r),i=n.CustomEvent;typeof i=="function"?i=new i(t,e):(i=n.document.createEvent("Event"),e?(i.initEvent(t,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(t,!1,!1)),r.dispatchEvent(i)}function ls(r,t){return function(){return Fn(this,r,t)}}function cs(r,t){return function(){return Fn(this,r,t.apply(this,arguments))}}function Bn(r,t){return this.each((typeof t=="function"?cs:ls)(r,t))}function*Vn(){for(var r=this._groups,t=0,e=r.length;t<e;++t)for(var n=r[t],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var Er=[null];function E(r,t){this._groups=r,this._parents=t}function Wn(){return new E([[document.documentElement]],Er)}function hs(){return this}E.prototype=Wn.prototype={constructor:E,select:sn,selectAll:an,selectChild:ln,selectChildren:cn,filter:hn,data:fn,enter:dn,exit:pn,join:gn,merge:mn,selection:hs,order:yn,sort:xn,call:bn,nodes:_n,node:wn,size:vn,empty:On,each:Sn,attr:Cn,style:kn,property:jn,classed:zn,text:An,html:Dn,raise:Nn,lower:Pn,append:Rn,insert:Ln,remove:Xn,clone:Hn,datum:Yn,on:$n,dispatch:Bn,[Symbol.iterator]:Vn};var dt=Wn;function X(r){return typeof r=="string"?new E([[document.querySelector(r)]],[document.documentElement]):new E([[r]],Er)}function Un(r){let t;for(;t=r.sourceEvent;)r=t;return r}function G(r,t){if(r=Un(r),t===void 0&&(t=r.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var n=e.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[r.clientX-i.left-t.clientLeft,r.clientY-i.top-t.clientTop]}}return[r.pageX,r.pageY]}function Ge(r){r.stopImmediatePropagation()}function mt(r){r.preventDefault(),r.stopImmediatePropagation()}function Wt(r){var t=r.document.documentElement,e=X(r).on("dragstart.drag",mt,!0);"onselectstart"in t?e.on("selectstart.drag",mt,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ut(r,t){var e=r.document.documentElement,n=X(r).on("dragstart.drag",null);t&&(n.on("click.drag",mt,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in e?n.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}var qt=r=>()=>r;function Gt(r,{sourceEvent:t,subject:e,target:n,identifier:i,active:o,x:s,y:a,dx:l,dy:c,dispatch:h}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:h}})}Gt.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function ds(r){return!r.ctrlKey&&!r.button}function us(){return this.parentNode}function fs(r,t){return t==null?{x:r.x,y:r.y}:t}function ps(){return navigator.maxTouchPoints||"ontouchstart"in this}function K(){var r=ds,t=us,e=fs,n=ps,i={},o=Ot("start","drag","end"),s=0,a,l,c,h,p=0;function f(g){g.on("mousedown.drag",m).filter(n).on("touchstart.drag",T).on("touchmove.drag",x).on("touchend.drag touchcancel.drag",D).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(g,O){if(!(h||!r.call(this,g,O))){var C=z(this,t.call(this,g,O),g,O,"mouse");!C||(X(g.view).on("mousemove.drag",S,!0).on("mouseup.drag",k,!0),Wt(g.view),Ge(g),c=!1,a=g.clientX,l=g.clientY,C("start",g))}}function S(g){if(mt(g),!c){var O=g.clientX-a,C=g.clientY-l;c=O*O+C*C>p}i.mouse("drag",g)}function k(g){X(g.view).on("mousemove.drag mouseup.drag",null),Ut(g.view,c),mt(g),i.mouse("end",g)}function T(g,O){if(!!r.call(this,g,O)){var C=g.changedTouches,M=t.call(this,g,O),P=C.length,F,J;for(F=0;F<P;++F)(J=z(this,M,g,O,C[F].identifier,C[F]))&&(Ge(g),J("start",g,C[F]))}}function x(g){var O=g.changedTouches,C=O.length,M,P;for(M=0;M<C;++M)(P=i[O[M].identifier])&&(mt(g),P("drag",g,O[M]))}function D(g){var O=g.changedTouches,C=O.length,M,P;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),M=0;M<C;++M)(P=i[O[M].identifier])&&(Ge(g),P("end",g,O[M]))}function z(g,O,C,M,P,F){var J=o.copy(),U=G(F||C,O),Xe,He,d;if((d=e.call(g,new Gt("beforestart",{sourceEvent:C,target:f,identifier:P,active:s,x:U[0],y:U[1],dx:0,dy:0,dispatch:J}),M))!=null)return Xe=d.x-U[0]||0,He=d.y-U[1]||0,function y(u,b,_){var w=U,v;switch(u){case"start":i[P]=y,v=s++;break;case"end":delete i[P],--s;case"drag":U=G(_||b,O),v=s;break}J.call(u,g,new Gt(u,{sourceEvent:b,subject:d,target:f,identifier:P,active:v,x:U[0]+Xe,y:U[1]+He,dx:U[0]-w[0],dy:U[1]-w[1],dispatch:J}),M)}}return f.filter=function(g){return arguments.length?(r=typeof g=="function"?g:qt(!!g),f):r},f.container=function(g){return arguments.length?(t=typeof g=="function"?g:qt(g),f):t},f.subject=function(g){return arguments.length?(e=typeof g=="function"?g:qt(g),f):e},f.touchable=function(g){return arguments.length?(n=typeof g=="function"?g:qt(!!g),f):n},f.on=function(){var g=o.on.apply(o,arguments);return g===o?f:g},f.clickDistance=function(g){return arguments.length?(p=(g=+g)*g,f):Math.sqrt(p)},f}function Ke(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function Ir(r,t){var e=Object.create(r.prototype);for(var n in t)e[n]=t[n];return e}function Jt(){}var Kt=.7,Je=1/Kt,At="\\s*([+-]?\\d+)\\s*",Zt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",st="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gs=/^#([0-9a-f]{3,8})$/,ms=new RegExp("^rgb\\("+[At,At,At]+"\\)$"),ys=new RegExp("^rgb\\("+[st,st,st]+"\\)$"),xs=new RegExp("^rgba\\("+[At,At,At,Zt]+"\\)$"),bs=new RegExp("^rgba\\("+[st,st,st,Zt]+"\\)$"),_s=new RegExp("^hsl\\("+[Zt,st,st]+"\\)$"),ws=new RegExp("^hsla\\("+[Zt,st,st,Zt]+"\\)$"),qn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ke(Jt,yt,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:Gn,formatHex:Gn,formatHsl:vs,formatRgb:Kn,toString:Kn});function Gn(){return this.rgb().formatHex()}function vs(){return ei(this).formatHsl()}function Kn(){return this.rgb().formatRgb()}function yt(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=gs.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?Zn(t):e===3?new B(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Ze(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Ze(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=ms.exec(r))?new B(t[1],t[2],t[3],1):(t=ys.exec(r))?new B(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=xs.exec(r))?Ze(t[1],t[2],t[3],t[4]):(t=bs.exec(r))?Ze(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_s.exec(r))?ti(t[1],t[2]/100,t[3]/100,1):(t=ws.exec(r))?ti(t[1],t[2]/100,t[3]/100,t[4]):qn.hasOwnProperty(r)?Zn(qn[r]):r==="transparent"?new B(NaN,NaN,NaN,0):null}function Zn(r){return new B(r>>16&255,r>>8&255,r&255,1)}function Ze(r,t,e,n){return n<=0&&(r=t=e=NaN),new B(r,t,e,n)}function Os(r){return r instanceof Jt||(r=yt(r)),r?(r=r.rgb(),new B(r.r,r.g,r.b,r.opacity)):new B}function Dt(r,t,e,n){return arguments.length===1?Os(r):new B(r,t,e,n==null?1:n)}function B(r,t,e,n){this.r=+r,this.g=+t,this.b=+e,this.opacity=+n}Ke(B,Dt,Ir(Jt,{brighter:function(r){return r=r==null?Je:Math.pow(Je,r),new B(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?Kt:Math.pow(Kt,r),new B(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jn,formatHex:Jn,formatRgb:Qn,toString:Qn}));function Jn(){return"#"+Tr(this.r)+Tr(this.g)+Tr(this.b)}function Qn(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(r===1?")":", "+r+")")}function Tr(r){return r=Math.max(0,Math.min(255,Math.round(r)||0)),(r<16?"0":"")+r.toString(16)}function ti(r,t,e,n){return n<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new ot(r,t,e,n)}function ei(r){if(r instanceof ot)return new ot(r.h,r.s,r.l,r.opacity);if(r instanceof Jt||(r=yt(r)),!r)return new ot;if(r instanceof ot)return r;r=r.rgb();var t=r.r/255,e=r.g/255,n=r.b/255,i=Math.min(t,e,n),o=Math.max(t,e,n),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(e-n)/a+(e<n)*6:e===o?s=(n-t)/a+2:s=(t-e)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new ot(s,a,l,r.opacity)}function ri(r,t,e,n){return arguments.length===1?ei(r):new ot(r,t,e,n==null?1:n)}function ot(r,t,e,n){this.h=+r,this.s=+t,this.l=+e,this.opacity=+n}Ke(ot,ri,Ir(Jt,{brighter:function(r){return r=r==null?Je:Math.pow(Je,r),new ot(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?Kt:Math.pow(Kt,r),new ot(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,n=e+(e<.5?e:1-e)*t,i=2*e-n;return new B(zr(r>=240?r-240:r+120,i,n),zr(r,i,n),zr(r<120?r+240:r-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function zr(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}function Ar(r,t,e,n,i){var o=r*r,s=o*r;return((1-3*r+3*o-s)*t+(4-6*o+3*s)*e+(1+3*r+3*o-3*s)*n+s*i)/6}function ni(r){var t=r.length-1;return function(e){var n=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),i=r[n],o=r[n+1],s=n>0?r[n-1]:2*i-o,a=n<t-1?r[n+2]:2*o-i;return Ar((e-n/t)*t,s,i,o,a)}}function ii(r){var t=r.length;return function(e){var n=Math.floor(((e%=1)<0?++e:e)*t),i=r[(n+t-1)%t],o=r[n%t],s=r[(n+1)%t],a=r[(n+2)%t];return Ar((e-n/t)*t,i,o,s,a)}}var Dr=r=>()=>r;function Ss(r,t){return function(e){return r+e*t}}function Cs(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(n){return Math.pow(r+n*t,e)}}function oi(r){return(r=+r)==1?Qe:function(t,e){return e-t?Cs(t,e,r):Dr(isNaN(t)?e:t)}}function Qe(r,t){var e=t-r;return e?Ss(r,e):Dr(isNaN(r)?t:r)}var tr=function r(t){var e=oi(t);function n(i,o){var s=e((i=Dt(i)).r,(o=Dt(o)).r),a=e(i.g,o.g),l=e(i.b,o.b),c=Qe(i.opacity,o.opacity);return function(h){return i.r=s(h),i.g=a(h),i.b=l(h),i.opacity=c(h),i+""}}return n.gamma=r,n}(1);function si(r){return function(t){var e=t.length,n=new Array(e),i=new Array(e),o=new Array(e),s,a;for(s=0;s<e;++s)a=Dt(t[s]),n[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return n=r(n),i=r(i),o=r(o),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=o(l),a+""}}}var ks=si(ni),js=si(ii);function Z(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}var Pr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nr=new RegExp(Pr.source,"g");function Ms(r){return function(){return r}}function Es(r){return function(t){return r(t)+""}}function Rr(r,t){var e=Pr.lastIndex=Nr.lastIndex=0,n,i,o,s=-1,a=[],l=[];for(r=r+"",t=t+"";(n=Pr.exec(r))&&(i=Nr.exec(t));)(o=i.index)>e&&(o=t.slice(e,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Z(n,i)})),e=Nr.lastIndex;return e<t.length&&(o=t.slice(e),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?Es(l[0].x):Ms(t):(t=l.length,function(c){for(var h=0,p;h<t;++h)a[(p=l[h]).i]=p.x(c);return a.join("")})}var ai=180/Math.PI,er={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Lr(r,t,e,n,i,o){var s,a,l;return(s=Math.sqrt(r*r+t*t))&&(r/=s,t/=s),(l=r*e+t*n)&&(e-=r*l,n-=t*l),(a=Math.sqrt(e*e+n*n))&&(e/=a,n/=a,l/=a),r*n<t*e&&(r=-r,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,r)*ai,skewX:Math.atan(l)*ai,scaleX:s,scaleY:a}}var rr;function li(r){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return t.isIdentity?er:Lr(t.a,t.b,t.c,t.d,t.e,t.f)}function ci(r){return r==null?er:(rr||(rr=document.createElementNS("http://www.w3.org/2000/svg","g")),rr.setAttribute("transform",r),(r=rr.transform.baseVal.consolidate())?(r=r.matrix,Lr(r.a,r.b,r.c,r.d,r.e,r.f)):er)}function hi(r,t,e,n){function i(c){return c.length?c.pop()+" ":""}function o(c,h,p,f,m,S){if(c!==p||h!==f){var k=m.push("translate(",null,t,null,e);S.push({i:k-4,x:Z(c,p)},{i:k-2,x:Z(h,f)})}else(p||f)&&m.push("translate("+p+t+f+e)}function s(c,h,p,f){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),f.push({i:p.push(i(p)+"rotate(",null,n)-2,x:Z(c,h)})):h&&p.push(i(p)+"rotate("+h+n)}function a(c,h,p,f){c!==h?f.push({i:p.push(i(p)+"skewX(",null,n)-2,x:Z(c,h)}):h&&p.push(i(p)+"skewX("+h+n)}function l(c,h,p,f,m,S){if(c!==p||h!==f){var k=m.push(i(m)+"scale(",null,",",null,")");S.push({i:k-4,x:Z(c,p)},{i:k-2,x:Z(h,f)})}else(p!==1||f!==1)&&m.push(i(m)+"scale("+p+","+f+")")}return function(c,h){var p=[],f=[];return c=r(c),h=r(h),o(c.translateX,c.translateY,h.translateX,h.translateY,p,f),s(c.rotate,h.rotate,p,f),a(c.skewX,h.skewX,p,f),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,p,f),c=h=null,function(m){for(var S=-1,k=f.length,T;++S<k;)p[(T=f[S]).i]=T.x(m);return p.join("")}}}var Xr=hi(li,"px, ","px)","deg)"),Hr=hi(ci,", ",")",")");var Is=1e-12;function di(r){return((r=Math.exp(r))+1/r)/2}function Ts(r){return((r=Math.exp(r))-1/r)/2}function zs(r){return((r=Math.exp(2*r))-1)/(r+1)}var Yr=function r(t,e,n){function i(o,s){var a=o[0],l=o[1],c=o[2],h=s[0],p=s[1],f=s[2],m=h-a,S=p-l,k=m*m+S*S,T,x;if(k<Is)x=Math.log(f/c)/t,T=function(M){return[a+M*m,l+M*S,c*Math.exp(t*M*x)]};else{var D=Math.sqrt(k),z=(f*f-c*c+n*k)/(2*c*e*D),g=(f*f-c*c-n*k)/(2*f*e*D),O=Math.log(Math.sqrt(z*z+1)-z),C=Math.log(Math.sqrt(g*g+1)-g);x=(C-O)/t,T=function(M){var P=M*x,F=di(O),J=c/(e*D)*(F*zs(t*P+O)-Ts(O));return[a+J*m,l+J*S,c*F/di(t*P+O)]}}return T.duration=x*1e3*t/Math.SQRT2,T}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return r(s,a,l)},i}(Math.SQRT2,2,4);var Nt=0,te=0,Qt=0,fi=1e3,nr,ee,ir=0,Ct=0,or=0,re=typeof performance=="object"&&performance.now?performance:Date,pi=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function ie(){return Ct||(pi(As),Ct=re.now()+or)}function As(){Ct=0}function ne(){this._call=this._time=this._next=null}ne.prototype=sr.prototype={constructor:ne,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?ie():+e)+(t==null?0:+t),!this._next&&ee!==this&&(ee?ee._next=this:nr=this,ee=this),this._call=r,this._time=e,$r()},stop:function(){this._call&&(this._call=null,this._time=1/0,$r())}};function sr(r,t,e){var n=new ne;return n.restart(r,t,e),n}function gi(){ie(),++Nt;for(var r=nr,t;r;)(t=Ct-r._time)>=0&&r._call.call(null,t),r=r._next;--Nt}function ui(){Ct=(ir=re.now())+or,Nt=te=0;try{gi()}finally{Nt=0,Ns(),Ct=0}}function Ds(){var r=re.now(),t=r-ir;t>fi&&(or-=t,ir=r)}function Ns(){for(var r,t=nr,e,n=1/0;t;)t._call?(n>t._time&&(n=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:nr=e);ee=r,$r(n)}function $r(r){if(!Nt){te&&(te=clearTimeout(te));var t=r-Ct;t>24?(r<1/0&&(te=setTimeout(ui,r-re.now()-or)),Qt&&(Qt=clearInterval(Qt))):(Qt||(ir=re.now(),Qt=setInterval(Ds,fi)),Nt=1,pi(ui))}}function kt(r,t,e){var n=new ne;return t=t==null?0:+t,n.restart(i=>{n.stop(),r(i+t)},t,e),n}var Ps=Ot("start","end","cancel","interrupt"),Rs=[],yi=0,Fr=1,lr=2,ar=3,mi=4,cr=5,oe=6;function xt(r,t,e,n,i,o){var s=r.__transition;if(!s)r.__transition={};else if(e in s)return;Ls(r,e,{name:t,index:n,group:i,on:Ps,tween:Rs,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:yi})}function se(r,t){var e=A(r,t);if(e.state>yi)throw new Error("too late; already scheduled");return e}function L(r,t){var e=A(r,t);if(e.state>ar)throw new Error("too late; already running");return e}function A(r,t){var e=r.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function Ls(r,t,e){var n=r.__transition,i;n[t]=e,e.timer=sr(o,0,e.time);function o(c){e.state=Fr,e.timer.restart(s,e.delay,e.time),e.delay<=c&&s(c-e.delay)}function s(c){var h,p,f,m;if(e.state!==Fr)return l();for(h in n)if(m=n[h],m.name===e.name){if(m.state===ar)return kt(s);m.state===mi?(m.state=oe,m.timer.stop(),m.on.call("interrupt",r,r.__data__,m.index,m.group),delete n[h]):+h<t&&(m.state=oe,m.timer.stop(),m.on.call("cancel",r,r.__data__,m.index,m.group),delete n[h])}if(kt(function(){e.state===ar&&(e.state=mi,e.timer.restart(a,e.delay,e.time),a(c))}),e.state=lr,e.on.call("start",r,r.__data__,e.index,e.group),e.state===lr){for(e.state=ar,i=new Array(f=e.tween.length),h=0,p=-1;h<f;++h)(m=e.tween[h].value.call(r,r.__data__,e.index,e.group))&&(i[++p]=m);i.length=p+1}}function a(c){for(var h=c<e.duration?e.ease.call(null,c/e.duration):(e.timer.restart(l),e.state=cr,1),p=-1,f=i.length;++p<f;)i[p].call(r,h);e.state===cr&&(e.on.call("end",r,r.__data__,e.index,e.group),l())}function l(){e.state=oe,e.timer.stop(),delete n[t];for(var c in n)return;delete r.__transition}}function bt(r,t){var e=r.__transition,n,i,o=!0,s;if(!!e){t=t==null?null:t+"";for(s in e){if((n=e[s]).name!==t){o=!1;continue}i=n.state>lr&&n.state<cr,n.state=oe,n.timer.stop(),n.on.call(i?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete e[s]}o&&delete r.__transition}}function xi(r){return this.each(function(){bt(this,r)})}function Xs(r,t){var e,n;return function(){var i=L(this,r),o=i.tween;if(o!==e){n=e=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}i.tween=n}}function Hs(r,t,e){var n,i;if(typeof e!="function")throw new Error;return function(){var o=L(this,r),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:t,value:e},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function bi(r,t){var e=this._id;if(r+="",arguments.length<2){for(var n=A(this.node(),e).tween,i=0,o=n.length,s;i<o;++i)if((s=n[i]).name===r)return s.value;return null}return this.each((t==null?Xs:Hs)(e,r,t))}function Pt(r,t,e){var n=r._id;return r.each(function(){var i=L(this,n);(i.value||(i.value={}))[t]=e.apply(this,arguments)}),function(i){return A(i,n).value[t]}}function hr(r,t){var e;return(typeof t=="number"?Z:t instanceof yt?tr:(e=yt(t))?(t=e,tr):Rr)(r,t)}function Ys(r){return function(){this.removeAttribute(r)}}function $s(r){return function(){this.removeAttributeNS(r.space,r.local)}}function Fs(r,t,e){var n,i=e+"",o;return function(){var s=this.getAttribute(r);return s===i?null:s===n?o:o=t(n=s,e)}}function Bs(r,t,e){var n,i=e+"",o;return function(){var s=this.getAttributeNS(r.space,r.local);return s===i?null:s===n?o:o=t(n=s,e)}}function Vs(r,t,e){var n,i,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(r):(s=this.getAttribute(r),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function Ws(r,t,e){var n,i,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(r.space,r.local):(s=this.getAttributeNS(r.space,r.local),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a)))}}function _i(r,t){var e=ht(r),n=e==="transform"?Hr:hr;return this.attrTween(r,typeof t=="function"?(e.local?Ws:Vs)(e,n,Pt(this,"attr."+r,t)):t==null?(e.local?$s:Ys)(e):(e.local?Bs:Fs)(e,n,t))}function Us(r,t){return function(e){this.setAttribute(r,t.call(this,e))}}function qs(r,t){return function(e){this.setAttributeNS(r.space,r.local,t.call(this,e))}}function Gs(r,t){var e,n;function i(){var o=t.apply(this,arguments);return o!==n&&(e=(n=o)&&qs(r,o)),e}return i._value=t,i}function Ks(r,t){var e,n;function i(){var o=t.apply(this,arguments);return o!==n&&(e=(n=o)&&Us(r,o)),e}return i._value=t,i}function wi(r,t){var e="attr."+r;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var n=ht(r);return this.tween(e,(n.local?Gs:Ks)(n,t))}function Zs(r,t){return function(){se(this,r).delay=+t.apply(this,arguments)}}function Js(r,t){return t=+t,function(){se(this,r).delay=t}}function vi(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?Zs:Js)(t,r)):A(this.node(),t).delay}function Qs(r,t){return function(){L(this,r).duration=+t.apply(this,arguments)}}function ta(r,t){return t=+t,function(){L(this,r).duration=t}}function Oi(r){var t=this._id;return arguments.length?this.each((typeof r=="function"?Qs:ta)(t,r)):A(this.node(),t).duration}function ea(r,t){if(typeof t!="function")throw new Error;return function(){L(this,r).ease=t}}function Si(r){var t=this._id;return arguments.length?this.each(ea(t,r)):A(this.node(),t).ease}function ra(r,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;L(this,r).ease=e}}function Ci(r){if(typeof r!="function")throw new Error;return this.each(ra(this._id,r))}function ki(r){typeof r!="function"&&(r=Bt(r));for(var t=this._groups,e=t.length,n=new Array(e),i=0;i<e;++i)for(var o=t[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&r.call(l,l.__data__,c,o)&&a.push(l);return new H(n,this._parents,this._name,this._id)}function ji(r){if(r._id!==this._id)throw new Error;for(var t=this._groups,e=r._groups,n=t.length,i=e.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=t[a],c=e[a],h=l.length,p=s[a]=new Array(h),f,m=0;m<h;++m)(f=l[m]||c[m])&&(p[m]=f);for(;a<n;++a)s[a]=t[a];return new H(s,this._parents,this._name,this._id)}function na(r){return(r+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function ia(r,t,e){var n,i,o=na(t)?se:L;return function(){var s=o(this,r),a=s.on;a!==n&&(i=(n=a).copy()).on(t,e),s.on=i}}function Mi(r,t){var e=this._id;return arguments.length<2?A(this.node(),e).on.on(r):this.each(ia(e,r,t))}function oa(r){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==r)return;t&&t.removeChild(this)}}function Ei(){return this.on("end.remove",oa(this._id))}function Ii(r){var t=this._name,e=this._id;typeof r!="function"&&(r=St(r));for(var n=this._groups,i=n.length,o=new Array(i),s=0;s<i;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),h,p,f=0;f<l;++f)(h=a[f])&&(p=r.call(h,h.__data__,f,a))&&("__data__"in h&&(p.__data__=h.__data__),c[f]=p,xt(c[f],t,e,f,c,A(h,e)));return new H(o,this._parents,t,e)}function Ti(r){var t=this._name,e=this._id;typeof r!="function"&&(r=Ft(r));for(var n=this._groups,i=n.length,o=[],s=[],a=0;a<i;++a)for(var l=n[a],c=l.length,h,p=0;p<c;++p)if(h=l[p]){for(var f=r.call(h,h.__data__,p,l),m,S=A(h,e),k=0,T=f.length;k<T;++k)(m=f[k])&&xt(m,t,e,k,f,S);o.push(f),s.push(h)}return new H(o,s,t,e)}var sa=dt.prototype.constructor;function zi(){return new sa(this._groups,this._parents)}function aa(r,t){var e,n,i;return function(){var o=gt(this,r),s=(this.style.removeProperty(r),gt(this,r));return o===s?null:o===e&&s===n?i:i=t(e=o,n=s)}}function Ai(r){return function(){this.style.removeProperty(r)}}function la(r,t,e){var n,i=e+"",o;return function(){var s=gt(this,r);return s===i?null:s===n?o:o=t(n=s,e)}}function ca(r,t,e){var n,i,o;return function(){var s=gt(this,r),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(r),gt(this,r))),s===l?null:s===n&&l===i?o:(i=l,o=t(n=s,a))}}function ha(r,t){var e,n,i,o="style."+t,s="end."+o,a;return function(){var l=L(this,r),c=l.on,h=l.value[o]==null?a||(a=Ai(t)):void 0;(c!==e||i!==h)&&(n=(e=c).copy()).on(s,i=h),l.on=n}}function Di(r,t,e){var n=(r+="")=="transform"?Xr:hr;return t==null?this.styleTween(r,aa(r,n)).on("end.style."+r,Ai(r)):typeof t=="function"?this.styleTween(r,ca(r,n,Pt(this,"style."+r,t))).each(ha(this._id,r)):this.styleTween(r,la(r,n,t),e).on("end.style."+r,null)}function da(r,t,e){return function(n){this.style.setProperty(r,t.call(this,n),e)}}function ua(r,t,e){var n,i;function o(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&da(r,s,e)),n}return o._value=t,o}function Ni(r,t,e){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,ua(r,t,e==null?"":e))}function fa(r){return function(){this.textContent=r}}function pa(r){return function(){var t=r(this);this.textContent=t==null?"":t}}function Pi(r){return this.tween("text",typeof r=="function"?pa(Pt(this,"text",r)):fa(r==null?"":r+""))}function ga(r){return function(t){this.textContent=r.call(this,t)}}function ma(r){var t,e;function n(){var i=r.apply(this,arguments);return i!==e&&(t=(e=i)&&ga(i)),t}return n._value=r,n}function Ri(r){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(r==null)return this.tween(t,null);if(typeof r!="function")throw new Error;return this.tween(t,ma(r))}function Li(){for(var r=this._name,t=this._id,e=dr(),n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var h=A(l,t);xt(l,r,e,c,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new H(n,this._parents,r,e)}function Xi(){var r,t,e=this,n=e._id,i=e.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};e.each(function(){var c=L(this,n),h=c.on;h!==r&&(t=(r=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),i===0&&o()})}var ya=0;function H(r,t,e,n){this._groups=r,this._parents=t,this._name=e,this._id=n}function Br(r){return dt().transition(r)}function dr(){return++ya}var jt=dt.prototype;H.prototype=Br.prototype={constructor:H,select:Ii,selectAll:Ti,filter:ki,merge:ji,selection:zi,transition:Li,call:jt.call,nodes:jt.nodes,node:jt.node,size:jt.size,empty:jt.empty,each:jt.each,on:Mi,attr:_i,attrTween:wi,style:Di,styleTween:Ni,text:Pi,textTween:Ri,remove:Ei,tween:bi,delay:vi,duration:Oi,ease:Si,easeVarying:Ci,end:Xi,[Symbol.iterator]:jt[Symbol.iterator]};function ur(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var xa={time:null,delay:0,duration:250,ease:ur};function ba(r,t){for(var e;!(e=r.__transition)||!(e=e[t]);)if(!(r=r.parentNode))throw new Error(`transition ${t} not found`);return e}function Hi(r){var t,e;r instanceof H?(t=r._id,r=r._name):(t=dr(),(e=xa).time=ie(),r=r==null?null:r+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&xt(l,r,t,c,s,e||ba(l,t));return new H(n,this._parents,r,t)}dt.prototype.interrupt=xi;dt.prototype.transition=Hi;var{abs:ff,max:pf,min:gf}=Math;function Yi(r){return[+r[0],+r[1]]}function _a(r){return[Yi(r[0]),Yi(r[1])]}var mf={name:"x",handles:["w","e"].map(Vr),input:function(r,t){return r==null?null:[[+r[0],t[0][1]],[+r[1],t[1][1]]]},output:function(r){return r&&[r[0][0],r[1][0]]}},yf={name:"y",handles:["n","s"].map(Vr),input:function(r,t){return r==null?null:[[t[0][0],+r[0]],[t[1][0],+r[1]]]},output:function(r){return r&&[r[0][1],r[1][1]]}},xf={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Vr),input:function(r){return r==null?null:_a(r)},output:function(r){return r}};function Vr(r){return{type:r}}var ae=r=>()=>r;function Wr(r,{sourceEvent:t,target:e,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function at(r,t,e){this.k=r,this.x=t,this.y=e}at.prototype={constructor:at,scale:function(r){return r===1?this:new at(this.k*r,this.x,this.y)},translate:function(r,t){return r===0&t===0?this:new at(this.k,this.x+this.k*r,this.y+this.k*t)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var le=new at(1,0,0);ce.prototype=at.prototype;function ce(r){for(;!r.__zoom;)if(!(r=r.parentNode))return le;return r.__zoom}function fr(r){r.stopImmediatePropagation()}function Rt(r){r.preventDefault(),r.stopImmediatePropagation()}function wa(r){return(!r.ctrlKey||r.type==="wheel")&&!r.button}function va(){var r=this;return r instanceof SVGElement?(r=r.ownerSVGElement||r,r.hasAttribute("viewBox")?(r=r.viewBox.baseVal,[[r.x,r.y],[r.x+r.width,r.y+r.height]]):[[0,0],[r.width.baseVal.value,r.height.baseVal.value]]):[[0,0],[r.clientWidth,r.clientHeight]]}function $i(){return this.__zoom||le}function Oa(r){return-r.deltaY*(r.deltaMode===1?.05:r.deltaMode?1:.002)*(r.ctrlKey?10:1)}function Sa(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ca(r,t,e){var n=r.invertX(t[0][0])-e[0][0],i=r.invertX(t[1][0])-e[1][0],o=r.invertY(t[0][1])-e[0][1],s=r.invertY(t[1][1])-e[1][1];return r.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function Ur(){var r=wa,t=va,e=Ca,n=Oa,i=Sa,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Yr,c=Ot("start","zoom","end"),h,p,f,m=500,S=150,k=0,T=10;function x(d){d.property("__zoom",$i).on("wheel.zoom",P).on("mousedown.zoom",F).on("dblclick.zoom",J).filter(i).on("touchstart.zoom",U).on("touchmove.zoom",Xe).on("touchend.zoom touchcancel.zoom",He).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(d,y,u,b){var _=d.selection?d.selection():d;_.property("__zoom",$i),d!==_?O(d,y,u,b):_.interrupt().each(function(){C(this,arguments).event(b).start().zoom(null,typeof y=="function"?y.apply(this,arguments):y).end()})},x.scaleBy=function(d,y,u,b){x.scaleTo(d,function(){var _=this.__zoom.k,w=typeof y=="function"?y.apply(this,arguments):y;return _*w},u,b)},x.scaleTo=function(d,y,u,b){x.transform(d,function(){var _=t.apply(this,arguments),w=this.__zoom,v=u==null?g(_):typeof u=="function"?u.apply(this,arguments):u,j=w.invert(v),I=typeof y=="function"?y.apply(this,arguments):y;return e(z(D(w,I),v,j),_,s)},u,b)},x.translateBy=function(d,y,u,b){x.transform(d,function(){return e(this.__zoom.translate(typeof y=="function"?y.apply(this,arguments):y,typeof u=="function"?u.apply(this,arguments):u),t.apply(this,arguments),s)},null,b)},x.translateTo=function(d,y,u,b,_){x.transform(d,function(){var w=t.apply(this,arguments),v=this.__zoom,j=b==null?g(w):typeof b=="function"?b.apply(this,arguments):b;return e(le.translate(j[0],j[1]).scale(v.k).translate(typeof y=="function"?-y.apply(this,arguments):-y,typeof u=="function"?-u.apply(this,arguments):-u),w,s)},b,_)};function D(d,y){return y=Math.max(o[0],Math.min(o[1],y)),y===d.k?d:new at(y,d.x,d.y)}function z(d,y,u){var b=y[0]-u[0]*d.k,_=y[1]-u[1]*d.k;return b===d.x&&_===d.y?d:new at(d.k,b,_)}function g(d){return[(+d[0][0]+ +d[1][0])/2,(+d[0][1]+ +d[1][1])/2]}function O(d,y,u,b){d.on("start.zoom",function(){C(this,arguments).event(b).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(b).end()}).tween("zoom",function(){var _=this,w=arguments,v=C(_,w).event(b),j=t.apply(_,w),I=u==null?g(j):typeof u=="function"?u.apply(_,w):u,it=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),R=_.__zoom,Q=typeof y=="function"?y.apply(_,w):y,lt=l(R.invert(I).concat(it/R.k),Q.invert(I).concat(it/Q.k));return function(tt){if(tt===1)tt=Q;else{var ct=lt(tt),kr=it/ct[2];tt=new at(kr,I[0]-ct[0]*kr,I[1]-ct[1]*kr)}v.zoom(null,tt)}})}function C(d,y,u){return!u&&d.__zooming||new M(d,y)}function M(d,y){this.that=d,this.args=y,this.active=0,this.sourceEvent=null,this.extent=t.apply(d,y),this.taps=0}M.prototype={event:function(d){return d&&(this.sourceEvent=d),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(d,y){return this.mouse&&d!=="mouse"&&(this.mouse[1]=y.invert(this.mouse[0])),this.touch0&&d!=="touch"&&(this.touch0[1]=y.invert(this.touch0[0])),this.touch1&&d!=="touch"&&(this.touch1[1]=y.invert(this.touch1[0])),this.that.__zoom=y,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(d){var y=X(this.that).datum();c.call(d,this.that,new Wr(d,{sourceEvent:this.sourceEvent,target:x,type:d,transform:this.that.__zoom,dispatch:c}),y)}};function P(d,...y){if(!r.apply(this,arguments))return;var u=C(this,y).event(d),b=this.__zoom,_=Math.max(o[0],Math.min(o[1],b.k*Math.pow(2,n.apply(this,arguments)))),w=G(d);if(u.wheel)(u.mouse[0][0]!==w[0]||u.mouse[0][1]!==w[1])&&(u.mouse[1]=b.invert(u.mouse[0]=w)),clearTimeout(u.wheel);else{if(b.k===_)return;u.mouse=[w,b.invert(w)],bt(this),u.start()}Rt(d),u.wheel=setTimeout(v,S),u.zoom("mouse",e(z(D(b,_),u.mouse[0],u.mouse[1]),u.extent,s));function v(){u.wheel=null,u.end()}}function F(d,...y){if(f||!r.apply(this,arguments))return;var u=C(this,y,!0).event(d),b=X(d.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",it,!0),_=G(d,w),w=d.currentTarget,v=d.clientX,j=d.clientY;Wt(d.view),fr(d),u.mouse=[_,this.__zoom.invert(_)],bt(this),u.start();function I(R){if(Rt(R),!u.moved){var Q=R.clientX-v,lt=R.clientY-j;u.moved=Q*Q+lt*lt>k}u.event(R).zoom("mouse",e(z(u.that.__zoom,u.mouse[0]=G(R,w),u.mouse[1]),u.extent,s))}function it(R){b.on("mousemove.zoom mouseup.zoom",null),Ut(R.view,u.moved),Rt(R),u.event(R).end()}}function J(d,...y){if(!!r.apply(this,arguments)){var u=this.__zoom,b=G(d.changedTouches?d.changedTouches[0]:d,this),_=u.invert(b),w=u.k*(d.shiftKey?.5:2),v=e(z(D(u,w),b,_),t.apply(this,y),s);Rt(d),a>0?X(this).transition().duration(a).call(O,v,b,d):X(this).call(x.transform,v,b,d)}}function U(d,...y){if(!!r.apply(this,arguments)){var u=d.touches,b=u.length,_=C(this,y,d.changedTouches.length===b).event(d),w,v,j,I;for(fr(d),v=0;v<b;++v)j=u[v],I=G(j,this),I=[I,this.__zoom.invert(I),j.identifier],_.touch0?!_.touch1&&_.touch0[2]!==I[2]&&(_.touch1=I,_.taps=0):(_.touch0=I,w=!0,_.taps=1+!!h);h&&(h=clearTimeout(h)),w&&(_.taps<2&&(p=I[0],h=setTimeout(function(){h=null},m)),bt(this),_.start())}}function Xe(d,...y){if(!!this.__zooming){var u=C(this,y).event(d),b=d.changedTouches,_=b.length,w,v,j,I;for(Rt(d),w=0;w<_;++w)v=b[w],j=G(v,this),u.touch0&&u.touch0[2]===v.identifier?u.touch0[0]=j:u.touch1&&u.touch1[2]===v.identifier&&(u.touch1[0]=j);if(v=u.that.__zoom,u.touch1){var it=u.touch0[0],R=u.touch0[1],Q=u.touch1[0],lt=u.touch1[1],tt=(tt=Q[0]-it[0])*tt+(tt=Q[1]-it[1])*tt,ct=(ct=lt[0]-R[0])*ct+(ct=lt[1]-R[1])*ct;v=D(v,Math.sqrt(tt/ct)),j=[(it[0]+Q[0])/2,(it[1]+Q[1])/2],I=[(R[0]+lt[0])/2,(R[1]+lt[1])/2]}else if(u.touch0)j=u.touch0[0],I=u.touch0[1];else return;u.zoom("touch",e(z(v,j,I),u.extent,s))}}function He(d,...y){if(!!this.__zooming){var u=C(this,y).event(d),b=d.changedTouches,_=b.length,w,v;for(fr(d),f&&clearTimeout(f),f=setTimeout(function(){f=null},m),w=0;w<_;++w)v=b[w],u.touch0&&u.touch0[2]===v.identifier?delete u.touch0:u.touch1&&u.touch1[2]===v.identifier&&delete u.touch1;if(u.touch1&&!u.touch0&&(u.touch0=u.touch1,delete u.touch1),u.touch0)u.touch0[1]=this.__zoom.invert(u.touch0[0]);else if(u.end(),u.taps===2&&(v=G(v,this),Math.hypot(p[0]-v[0],p[1]-v[1])<T)){var j=X(this).on("dblclick.zoom");j&&j.apply(this,arguments)}}}return x.wheelDelta=function(d){return arguments.length?(n=typeof d=="function"?d:ae(+d),x):n},x.filter=function(d){return arguments.length?(r=typeof d=="function"?d:ae(!!d),x):r},x.touchable=function(d){return arguments.length?(i=typeof d=="function"?d:ae(!!d),x):i},x.extent=function(d){return arguments.length?(t=typeof d=="function"?d:ae([[+d[0][0],+d[0][1]],[+d[1][0],+d[1][1]]]),x):t},x.scaleExtent=function(d){return arguments.length?(o[0]=+d[0],o[1]=+d[1],x):[o[0],o[1]]},x.translateExtent=function(d){return arguments.length?(s[0][0]=+d[0][0],s[1][0]=+d[1][0],s[0][1]=+d[0][1],s[1][1]=+d[1][1],x):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},x.constrain=function(d){return arguments.length?(e=d,x):e},x.duration=function(d){return arguments.length?(a=+d,x):a},x.interpolate=function(d){return arguments.length?(l=d,x):l},x.on=function(){var d=c.on.apply(c,arguments);return d===c?x:d},x.clickDistance=function(d){return arguments.length?(k=(d=+d)*d,x):Math.sqrt(k)},x.tapDistance=function(d){return arguments.length?(T=+d,x):T},x}var uo=Tt(zt());var ut=class{constructor(){this.type=null,this.render=null,this.text="",this.editable=!0,this.foreColor="black",this.fontSize=16,this.fontFamily="Malgun Gothic",this.textDecoration="none",this.visibleOverText=!0,this.opacity=1,this.cursor="move",this.borderColor="black",this.borderWidth=1,this.borderDash=0,this.isSelected=!1,this.isMonitoring=!0,this.isHovered=!1,this.tooltipText="",this.tooltipFontSize=12,this.tooltipForeColor="black",this.tooltipFontFamily="Malgun Gothic",this.tooltipFill="white",this.tooltipMaxWidth=380,this.tooltipBorderColor="#bbb",this.tooltipBorderWidth=1,this.tooltipBorderDash=0,this.tooltipPadding=10,this.tooltipTextDecoration="none",this.tooltipVisible=!0,this["borderWidth.selected"]=2,this["borderColor.selected"]="blue"}};var ka=new Set(["id","type","render","text","editable","isSelected","isMonitoring","isHovered","node.width","node.height","node.x","node.y","node.connectorEnabled","node.resizerEnabled","connection.points","connection.sourceObjId","connection.sourcePos","connection.destinationObjId","connection.destinationPos","group.borderAlwaysAppearance","group.margin"]),he=class{constructor(t){this.data=t}_getPostFix(){return this.data.isSelected?".selected":this.data.isHovered?".hovered":""}get(t){if(ka.has(t))return this.data[t];{let e=`${t}${this._getPostFix()}`;return this.data[e]!==void 0?this.data[e]:this.data[t]}}};var Kr=Tt(zt());var de=class extends ut{constructor(){super(),this["connection.points"]=[],this["connection.sourceObjId"]=null,this["connection.sourcePos"]=null,this["connection.destinationObjId"]=null,this["connection.destinationPos"]=null,this["connection.width"]=200,this["connection.arrowFill"]="black",this["connection.arrowSize"]=10,this["connection.textBorderColor"]="black",this["connection.textBorderWidth"]=1,this["connection.textBorderDash"]=0,this["connection.textBorderFill"]="white",this["connection.connectorFill"]="black",this["connection.connectorSize"]=3,this["connection.adjusterSize"]=7,this["connection.adjusterFill"]="black",this["connection.arrowBorderColor"]="black",this["connection.arrowBorderWidth"]=1}};var ue=class extends ut{constructor(){super(),this["group.margin"]=20,this["group.borderAlwaysAppearance"]=!1}};var fe=class extends ut{constructor(){super(),this["node.width"]=120,this["node.height"]=60,this["node.fill"]="white",this["node.x"]=0,this["node.y"]=0,this["node.connectorGap"]=15,this["node.connectorSize"]=5,this["node.resizerEnabled"]=!0,this["node.connectorEnabled"]=!0,this["node.commentTopLeft"]="",this["node.commentTopCenter"]="",this["node.commentTopRight"]="",this["node.commentBottomLeft"]="",this["node.commentBottomCenter"]="",this["node.commentBottomRight"]="",this["node.commentFontSize"]=10,this["node.commentForeColor"]="black",this["node.commentFontFamily"]="Noto Sans KR"}};var ja=document.createElement("canvas"),Fi=ja.getContext("2d"),pe=2,ge=10,qr=(r,t)=>{Fi.font=`${t.fontSize}px ${t.fontFamily}`;let e=Fi.measureText(r);return{width:e.width,height:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}},me=r=>{let{text:t}=r,e=[],n=[];for(let i of t){if(i==="\r")continue;if(i===`
`){e.push(n.join("")),n.length=0;continue}n.push(i);let o=n.join("");qr(o,r).width>=r.width&&(e.push(o),n.length=0)}return n.length>0&&e.push(n.join("")),{length:e.length,lineHeight:qr("|",r).height,lines:e}},gr=r=>{let t=r.text.replace("\r","").split(`
`),e=0,n=0;return t.forEach(i=>{let o=qr(i,r);n+=r.fontSize+pe,e=Math.max(e,o.width)}),{width:e,height:n}},Bi=(r,t)=>{let e=me(r),n=e.lineHeight*e.length;if(t<n){let i=parseInt(Math.ceil((n-t)/e.lineHeight));e.lines=e.lines.splice(0,e.length-i),e.length=e.lines.length,e.lines[e.length-1]+="..."}return e};var Mt=class{constructor(){this.text="",this.length=0,this.width=0,this.height=0,this.x=0,this.y=0}compareTo(t){return this.text===t.text&&this.length===t.length&&this.width===t.width&&this.height===t.height&&this.x===t.x&&this.y===t.y}update(t){this.text=t.text,this.length=t.length,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y}clear(){this.text="",this.length=0,this.width=0,this.height=0,this.x=0,this.y=0}};var Ma=/translate\((-?[\d.]+),\s*?(-?[\d.]+)\)/,Ea=/scale\(([\d.]+),\s*?([\d.]+)\)/,Vi={top:0,right:1,bottom:2,left:3},N=45,Ia={node:new fe,group:new ue,connection:new de};function Zr(r,t){switch(r.id){case t.sourceObjId:return Vi[t.sourcePos];case t.destinationObjId:return Vi[t.destinationPos];default:throw new Error("It's not connected.")}}function Wi(r){if(r.indexOf("left")!==-1)return"left";if(r.indexOf("right")!==-1)return"right";if(r.indexOf("top")!==-1)return"top";if(r.indexOf("bottom")!==-1)return"bottom";throw new Error(`Invalid argument '${r}'`)}function Ui(r){let t=Ma.exec(r),e=Ea.exec(r),n=0,i=0,o=1;return t&&(n=parseFloat(t[1]),i=parseFloat(t[2])),e&&(o=parseFloat(e[1])),{translateX:n,translateY:i,scale:o}}function et(r,t,e){r[t]===void 0&&(r[t]=e)}function Ta(r){switch(et(r,"cursor","move"),r.temp&&(et(r,"node.resizerEnabled",!1),et(r,"node.connectorEnabled",!1)),r.render){case"start":{et(r,"node.resizerEnabled",!1);break}case"comment":{et(r,"node.connectorEnabled",!1);break}case"bridge":{et(r,"editable",20),et(r,"node.width",20),et(r,"node.height",20),et(r,"node.resizerEnabled",!1);break}default:break}}function za(r){et(r,"cursor","pointer"),(r["connection.points"]===null||r["connection.points"]==null)&&(r["connection.points"]=[]);let t=r["connection.points"];for(let e=t.length;e<2;e++)t.push({x:0,y:0})}function Jr(r,t){return Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))}function Qr(r,t){let e=Ia[r.type];if(e===void 0)throw new Error(`Unknown type '${r.type}'`);for(let n of Object.keys(e))r[n]===void 0&&(r[n]=t[n]);return r}function qi(r){switch(r.type){case"node":{Ta(r);break}case"connection":{za(r);break}case"group":{et(r,"borderDash.selected",1);break}default:break}}function Gi(r){let t=q({},r.data),e=r.firstPoint;switch(r.sourcePos){case"top":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x,y:e.y-N}]:t["connection.points"]=[e,{x:e.x+N,y:e.y-N}];break}case"bottom":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x,y:e.y+N}]:t["connection.points"]=[e,{x:e.x+N,y:e.y+N}];break}case"left":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x-N,y:e.y}]:t["connection.points"]=[e,{x:e.x-N,y:e.y+N}];break}case"right":{r.renderType==="direct"?t["connection.points"]=[e,{x:e.x+N,y:e.y}]:t["connection.points"]=[e,{x:e.x+N,y:e.y+N}];break}default:r.renderType==="direct"?t["connection.points"]=[e,{x:e.x+N,y:e.y+N}]:t["connection.points"]=[e,{x:e.x+N/2,y:e.y+N/2},{x:e.x+N,y:e.y+N}];break}return t}function _t(r){let t=[];return r.forEach(e=>{t.push(Kr.cloneDeep(e.data))}),t}function mr(r){return Kr.cloneDeep(r)}function*tn(r){switch(r.type){case"node":yield{key:"node.x",value:r["node.x"]},yield{key:"node.y",value:r["node.y"]};break;case"connection":yield{key:"connection.sourceObjId",value:r["connection.sourceObjId"]},yield{key:"connection.sourcePos",value:r["connection.sourcePos"]},yield{key:"connection.destinationObjId",value:r["connection.destinationObjId"]},yield{key:"connection.destinationPos",value:r["connection.destinationPos"]},yield{key:"connection.points",value:mr(r["connection.points"])};break;case"group":break;default:throw new Error(`Unknow type '${r.type}'`)}}function en(r,t,e,n){r.attr("x",t).attr("y",e).attr("fill",n.foreColor).attr("font-family",n.fontFamily).attr("font-size",n.fontSize).attr("text-decoration",n.textDecoration)}function yr(r,t,e,n,i){en(r,e,n,i),t.lines.forEach((o,s)=>{let a=r.append("tspan").attr("x",e).attr("dx",0).attr("dy",s===0?0:i.fontSize+pe).text(o);o.trim()===""&&a.attr("opacity","0").attr("fill-opacity","0").text(".")})}function Ki(r,t){r.selectAll("tspan").remove(),t.clear()}function Zi(r){return new Ye(r)}var ft=class{constructor(t,e,n){this.data=t,this.className=e,this.iContainer=n,this.textCache=new Mt,this.dataWrapper=new he(t),this.container=n.getSvg().select(".container"),this.group=this.container.append("g").attr("class",`${t.type} ${e}`),this.objects={foreignObj:null,textarea:null,text:this.group.append("text").attr("class","unselectable text--whitespace-pre").attr("text-anchor","middle")}}get width(){throw new Error("Not implemented!")}get height(){throw new Error("Not implemented!")}get subUiVisilbility(){return this.data.isSelected&&this.iContainer.getReadOnly()===!1?"visible":"hidden"}get isHovered(){return this.data.isHovered}_getLabelRect(){return{x:0,y:0,width:0,height:0}}_repositionTextarea(){let t=this._getLabelRect();this.objects.foreignObj.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height),this.objects.textarea.style("width",`${t.width-22}px`).style("height",`${t.height}px`).style("border","1px solid var(--border-color)").style("background-color","transparent")}removeLabelEdit(){this.objects.foreignObj&&(this.objects.text.attr("visibility","visible"),this.objects.textarea=null,this.objects.foreignObj.remove(),this.objects.foreignObj=null,this.iContainer.setEditMode(!1))}cancelLabelEdit(t){this.removeLabelEdit(),this.data.text=t}editLabelMode(){if(!this.data.editable||this.objects.foreignObj||this.data.render=="bridge")return;let t=this.data.text;this.group.classed("edit",!0),this.iContainer.setEditMode(!0),this.objects.text.attr("visibility","hidden"),this.objects.foreignObj=this.group.append("foreignObject"),this.objects.textarea=this.objects.foreignObj.append("xhtml:div").style("overflow","auto").append("textarea").style("resize","none").style("text-align","center").style("border","none").style("font-family",this.data.fontFamily).style("font-size",`${this.data.fontSize}px`).on("keyup",e=>{e.key==="Escape"?(this.cancelLabelEdit(t),this.iContainer.getSvg().node().parentElement.focus()):(this.data.text=this.objects.textarea.node().value,this._repositionTextarea())}).on("focusout",()=>{this.objects.textarea&&(this.data.text=this.objects.textarea.node().value,this.iContainer.editTextCallback(this.data,t,this.data.text),this.removeLabelEdit()),this.group.classed("edit",!1),this.render()}),this._repositionTextarea(),this.objects.textarea.node().value=this.data.text||"",this.objects.textarea.node().focus(),this.iContainer.editTextModeCallback(this.data)}bringToFrontElement(t){this.group.node().appendChild(t)}create(){this._create(),this.bringToFrontElement(this.objects.text.node()),this.render()}_create(){throw new Error("Not implemented method!")}render(){this._render(),this.group.attr("cursor",this.dataWrapper.get("cursor")),this.group.attr("opacity",this.dataWrapper.get("opacity"))}_render(){throw new Error("Not implemented method!")}_getLabelXY(t){return{x:0,y:0}}_createText(t=0,e=0){let n={width:this.width-ge,text:this.dataWrapper.get("text"),fontFamily:this.dataWrapper.get("fontFamily"),fontSize:this.dataWrapper.get("fontSize"),foreColor:this.dataWrapper.get("foreColor"),textDecoration:this.dataWrapper.get("textDecoration")},o=this.dataWrapper.get("visibleOverText")?me(n):Bi(n,this.height-ge),s=this._getLabelXY(o),a={text:n.text,width:this.width,height:this.height,length:o.lines.length,x:s.x,y:s.y,fontFamily:n.fontFamily,fontSize:n.fontSize,foreColor:n.foreColor,textDecoration:n.textDecoration};if(this.textCache.compareTo(a)){en(this.objects.text,s.x+t,s.y+e,n);return}Ki(this.objects.text,this.textCache),yr(this.objects.text,o,s.x+t,s.y+e,n),this.textCache.update(a)}destroy(){this.group.remove()}};var xr=class{constructor(t,e,n,i){this.renderObj=t,this.key=e,this.newValue=n,this.oldValue=i}};var pt=class{constructor(t,e,n){this.data=t,this.renderer=e,this.icontainer=n,this.temp={clickedSeq:0}}get onEditing(){return this.renderer.objects.foreignObj!==null}get clickedSeq(){return this.temp.clickedSeq}get tooltipText(){return this.getDataOrNull("tooltipText")}get g(){return this.renderer.group}get isSelected(){return this.data.isSelected}get type(){return this.data.type}get renderType(){return this.data.render}get tooltipVisible(){return this.getDataOrNull("tooltip.visible")}get canShowTooltip(){return this.getDataOrNull("tooltipText")&&this.getDataOrNull("tooltipVisible")}get id(){return this.data.id}get startX(){throw new Error("Not Implemented!")}get startY(){throw new Error("Not Implemented!")}get isTempObj(){return this.data.temp||!1}get zIndex(){let t=0,e=this.renderer.group.node().previousSibling;for(;e!==null;)e=e.previousSibling,++t;return t}get centerX(){return(this.x+this.endX)/2}get centerY(){return(this.y+this.endY)/2}get x(){throw new Error("Not Implemented!")}get y(){throw new Error("Not Implemented!")}get endX(){throw new Error("Not Implemented!")}get endY(){throw new Error("Not Implemented!")}get width(){throw new Error("Not Implemented!")}get height(){throw new Error("Not Implemented!")}get textDecoration(){return this.getDataOrNull("textDecoration")}get isHovered(){return this.data.isHovered}set id(t){this.data.id=t}set x(t){throw new Error("Not Implemented!")}set y(t){throw new Error("Not Implemented!")}set width(t){throw new Error("Not Implemented!")}set height(t){throw new Error("Not Implemented!")}set textDecoration(t){this.data.textDecoration=t}set isHovered(t){this.data.isHovered=t}set clickedSeq(t){this.temp.clickedSeq=t}set zIndex(t){let e=this.renderer.container.node(),n=this.renderer.group.node();t==null||t>=e.children.length?e.appendChild(n):e.insertBefore(n,e.children[t])}observeProperties(){Object.keys(this.data).forEach(t=>{let e=this.data[t];Object.defineProperty(this.data,t,{enumerable:!0,get:()=>e,set:n=>{let i=e;e=n,this.data.isMonitoring&&(this.icontainer.observerCallback(new xr(this,t,n,i)),this.render())}})})}changeRender(t,e){this.data.render=t,this.destroy(),this.renderer=e,this.create()}create(){this.renderer.create(),this.observeProperties()}destroy(){this.renderer.destroy()}render(){this.renderer.render(),this.icontainer.renderCallback(this)}moveTo(t,e){this.editProp(()=>{this.x+=t,this.y+=e})}select(t=!1,e=""){this.data.isSelected===!1&&(this.data.isSelected=!0,this.icontainer.selectCallback(this,t,e))}release(t=!1){this.data.isSelected&&(this.data.isSelected=!1,this.icontainer.releaseCallback(this,t))}editLabel(){this.renderer.editLabelMode()}getDataOrNull(t){return this.renderer.dataWrapper.get(t)||null}editProp(t){try{this.data.isMonitoring=!1,t()}finally{this.data.isMonitoring=!0}}};var ye=class{constructor({observerCallback:t,getObjectOrNull:e,setEditMode:n,removeObject:i,renderCallback:o,addRenderObj:s,adjDragCallback:a,editTextCallback:l,selectCallback:c,releaseCallback:h,getReadOnly:p,getLogger:f,editTextModeCallback:m,initDrag:S,terminateDrag:k,getTooltipHidden:T,getSelectNodeOnHover:x,getSvg:D,releaseAllObjects:z,changeObjRender:g,isAppending:O,getUUID:C}){this.observerCallback=t,this.getObjectOrNull=e,this.setEditMode=n,this.removeObject=i,this.renderCallback=o,this.addRenderObj=s,this.adjDragCallback=a,this.editTextCallback=l,this.selectCallback=c,this.releaseCallback=h,this.getReadOnly=p,this.getLogger=f,this.editTextModeCallback=m,this.initDrag=S,this.terminateDrag=k,this.getTooltipHidden=T,this.getSelectNodeOnHover=x,this.getSvg=D,this.releaseAllObjects=z,this.changeObjRender=g,this.isAppending=O,this.getUUID=C}};var rt=class{constructor(t,e){this.command=t,this.icontainer=e}undo(){return this}redo(){return this}};var nt=class extends rt{constructor(t,e){super("add",e),this.objDataList=t}undo(){return this.objDataList.forEach(t=>this.icontainer.removeObject(t.id)),super.undo()}redo(){return this.objDataList.forEach(t=>this.icontainer.addRenderObj(t)),super.redo()}};var Xt=class extends nt{constructor(t,e){super(t,e),this.command="delete"}undo(){return super.redo()}redo(){return super.undo()}};var Ji=["node.width","node.height"],V=class{constructor(t,e){this.objData=t,this.propList=e||[]}addMoveOldValues(){for(let t of tn(this.objData))this.propList.push({key:t.key,oldValue:t.value})}addSizeOldValues(){for(let t of Ji)this.propList.push({key:t,oldValue:this.objData[t],newValue:this.objData[t]})}updateSizeNewValues(){for(let t of Ji){let e=this.propList.filter(n=>n.key===t)[0];e.newValue=this.objData[t]}}updateMoveNewValues(){for(let t of tn(this.objData)){let e=this.propList.filter(n=>n.key===t.key)[0];e.newValue=t.value}}},W=class extends rt{constructor(t,e){super("edit",e),this.changeInfoList=t}_setValue(t){this.changeInfoList.forEach(e=>{let n=this.icontainer.getObjectOrNull(e.objData.id);n!==null&&n.editProp(()=>{for(let i of e.propList)n.data[i.key]=i[t]})})}undo(){return this._setValue("oldValue"),super.undo()}redo(){return this._setValue("newValue"),super.redo()}};var xe=class extends rt{constructor(t,e,n,i){super("render",i),this.renderObj=t,this.oldRender=e,this.newRender=n}undo(){return this.icontainer.changeObjRender(this.renderObj,this.oldRender),super.undo()}redo(){return this.icontainer.changeObjRender(this.renderObj,this.newRender),super.redo()}};var br=Tt(zt());var be=class extends rt{constructor(t,e){super("front",e),this.dataList=t}_setZId(t,e){let n=i=>{let o=this.icontainer.getObjectOrNull(i.objId);if(o===null){this.icontainer.getLogger().error("ZIndexCommand._setZId()",`Could not find obj id '${i.objId}'`);return}o.zIndex=i[t]};e?br.forEach(this.dataList,n):br.forEachRight(this.dataList,n)}undo(){return this._setZId("oldValue",!1),super.undo()}redo(){return this._setZId("newValue",!0),super.redo()}};var _e=class{constructor(t){this.actionLimit=t,this.undoStackList=[],this.redoStackList=[]}addAction(...t){this.undoStackList.length===this.actionLimit&&this.undoStackList.splice(0,1),this.undoStackList.push(t),this.redoStackList.splice(0,this.redoStackList.length)}clear(){this.undoStackList.splice(0,this.undoStackList.length),this.redoStackList.splice(0,this.redoStackList.length)}popLastUndoAction(){return this.undoStackList.pop()}undo(){if(this.undoStackList.length===0)return null;let t=this.undoStackList.pop();return t.forEach(e=>e.undo()),this.redoStackList.push(t.reverse()),t}redo(){if(this.redoStackList.length===0)return null;let t=this.redoStackList.pop();return t.forEach(e=>e.redo()),this.undoStackList.push(t.reverse()),t}};var ro=Tt(zt());var eo=Tt(zt());var we=class extends pt{get points(){return this.data["connection.points"]}get endX(){return this.points.reduce((t,e)=>Math.max(t,e.x),0)}get endY(){return this.points.reduce((t,e)=>Math.max(t,e.y),0)}get sourceObjId(){return this.data["connection.sourceObjId"]||null}get sourceObj(){return this.icontainer.getObjectOrNull(this.data["connection.sourceObjId"])}get destinationObj(){return this.icontainer.getObjectOrNull(this.data["connection.destinationObjId"])}get destinationObjId(){return this.data["connection.destinationObjId"]||null}get sourcePos(){return this.data["connection.sourcePos"]||null}get destinationPos(){return this.data["connection.destinationPos"]||null}get firstPoint(){return this.points[0]}get endPoint(){return this.points[this.points.length-1]}get startX(){return this.points.reduce((t,e)=>Math.min(t,e.x),Number.MAX_VALUE)}get startY(){return this.points.reduce((t,e)=>Math.min(t,e.y),Number.MAX_VALUE)}get width(){if(!this.points)return NaN;let t=this.points.reduce((e,n)=>({min:Math.min(e.min,n.x),max:Math.max(e.max,n.x)}),{min:Number.MAX_VALUE,max:Number.MIN_VALUE});return t.max-t.min}get height(){if(!this.points)return NaN;let t=this.points.reduce((e,n)=>({min:Math.min(e.min,n.y),max:Math.max(e.max,n.y)}),{min:Number.MAX_VALUE,max:Number.MIN_VALUE});return t.max-t.min}get x(){let t=this.firstPoint;return t!==null?t.x:null}get y(){let t=this.firstPoint;return t!==null?t.y:null}set sourceObjId(t){this.data["connection.sourceObjId"]=t||null}set destinationObjId(t){this.data["connection.destinationObjId"]=t||null}set sourcePos(t){this.data["connection.sourcePos"]=t||null}set destinationPos(t){this.data["connection.destinationPos"]=t||null}set x(t){if(this.sourceObjId!==null)return;let e=this.firstPoint;e!==null&&(e.x=t,this.render())}set y(t){if(this.sourceObjId!==null)return;let e=this.firstPoint;e!==null&&(e.y=t,this.render())}setLastPointXY(t,e){this.data["connection.points"][this.renderer.lastPointId].x=t,this.data["connection.points"][this.renderer.lastPointId].y=e,this.render()}moveTo(t,e){if(this.sourceObj&&this.destinationObj)return;let n=this.sourceObj===null?0:1,i=this.points.length-(this.destinationObj===null?0:1);this.editProp(()=>{this.points.slice(n,i).forEach(o=>{o.x+=t,o.y+=e})})}comparePoints(t){if(!this.points||!t||this.points.length!==t.length)return!1;for(let e=0;e<t.length;e++)if(this.points[e].x!==t[e].x&&this.points[e].y!==t[e].y)return!1;return!0}};var ve=class extends pt{constructor(t,e,n){super(t,e,n),this.objectSet=new Set(this.data.objectList||[]),this.rect={x:0,y:0,width:0,height:0}}get startX(){return this.x}get startY(){return this.y}get x(){return this.rect.x}get y(){return this.rect.y}get width(){return this.rect.width}get height(){return this.rect.height}get endX(){return this.x+this.width}get endY(){return this.y+this.height}select(t,e=""){this.objectSet.forEach(n=>{let i=this.icontainer.getObjectOrNull(n);i!=null&&(e==""||e!=""&&e==i.renderType)&&(i.data.isSelected=!0)}),super.select(t)}release(t=!1){this.objectSet.forEach(e=>{let n=this.icontainer.getObjectOrNull(e);n!=null&&n.release(t)}),super.release(t)}resize(){let t=this.data["group.margin"],e=Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MIN_VALUE,o=Number.MIN_VALUE;this.objectSet.forEach(s=>{let a=this.icontainer.getObjectOrNull(s);a!==null&&(e=Math.min(a.startX-t,e),i=Math.max(a.endX+t,i),n=Math.min(a.startY-t,n),o=Math.max(a.endY+t,o))}),this.data["group.rect"]=this.rect,this.rect.x=e,this.rect.y=n,this.rect.width=i-e,this.rect.height=o-n}moveTo(){this.render()}hasObjId(t){return this.objectSet.has(t)}destroy(){this.objectSet.clear(),super.destroy()}destroyAll(){this.objectSet.forEach(t=>{let e=this.icontainer.getObjectOrNull(t);e!=null&&this.icontainer.removeObject(e)}),this.destroy()}clear(){this.objectSet.clear()}addObject(t){if(this.objectSet.has(t)===!1)this.objectSet.add(t),this.resize();else throw new Error(`Already has added id! '${t}'`)}removeObject(t){if(this.objectSet.has(t))this.objectSet.delete(t),this.resize();else throw new Error(`There is no id you received in this group!'${t}'`)}};var Ht=6,Qi=5,to=[["TopLeft","start"],["TopCenter","middle"],["TopRight","end"],["BottomLeft","start"],["BottomCenter","middle"],["BottomRight","end"]],$=class extends ft{constructor(t,e,n){super(t,e,n),this.svg=this.iContainer.getSvg(),this.connectors=[],this.resizers=[],this.comments=[]}get width(){return this.data["node.width"]}get height(){return this.data["node.height"]}get connectorVisibility(){return this.data["node.connectorEnabled"]&&this.iContainer.isAppending()}get resizerVisibility(){return this.data["node.resizerEnabled"]===!0&&this.data.isSelected}_createComments(){to.forEach(t=>{let[e,n]=t;this.comments.push(this.group.append("text").attr("class",`${e} unselectable`).attr("text-anchor",n))})}_createResizer(){let t=this.group;for(let e of this.getResizerPosition()){let n=t.append("rect").attr("x",e[0]-Ht/2).attr("y",e[1]-Ht/2).attr("width",Ht).attr("height",Ht).attr("fill","rgb(173, 216, 230)").attr("stroke","rgb(30, 144, 255)").attr("cursor",e[2]).attr("class","resizer").attr("visibility","hidden");this.resizers.push(n)}}_createConnector(){let t=this.group;for(let e of this.getConnectorPosition()){let n=t.append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",this.dataWrapper.get("node.connectorSize")).attr("class",`connector ${e.dir}`);this.connectors.push(n)}}_renderComments(){let t=this.dataWrapper,e=t.get("node.commentFontFamily"),n=t.get("node.commentFontSize"),i=this.width/2,o=this.height/2,s=-(o+Qi),a=o+Qi+n,l={TopLeft:{x:-i,y:s},TopCenter:{x:0,y:s},TopRight:{x:i,y:s},BottomLeft:{x:-i,y:a},BottomCenter:{x:0,y:a},BottomRight:{x:i,y:a}};to.forEach((c,h)=>{let p=l[c[0]];this.comments[h].attr("x",p.x).attr("y",p.y).attr("font-family",e).attr("font-size",n).text(()=>this.dataWrapper.get(`node.comment${c[0]}`))})}_renderConnector(){let t=0;for(let e of this.getConnectorPosition())this.isHovered&&this.connectorVisibility&&this.iContainer.getReadOnly()===!1?(this.bringToFrontElement(this.connectors[t].node()),this.connectors[t++].attr("cx",e.x).attr("cy",e.y).attr("visibility","visible").attr("r",this.dataWrapper.get("node.connectorSize")).classed("active",!0)):this.connectors[t++].classed("active",!1).attr("visibility",this.connectorVisibility&&this.iContainer.getReadOnly()===!1?"visible":"hidden")}_renderResizer(){if(this.resizers.length===0)return;let t=0;for(let e of this.getResizerPosition())this.isHovered&&this.resizerVisibility&&this.iContainer.getReadOnly()===!1?(this.bringToFrontElement(this.resizers[t].node()),this.resizers[t++].attr("x",e[0]-Ht/2).attr("y",e[1]-Ht/2).attr("class","resizer").attr("visibility","visible").classed("active",!0)):this.resizers[t++].classed("active",!1).attr("visibility",this.resizerVisibility&&this.iContainer.getReadOnly()===!1?"visible":"hidden")}*getConnectorPosition(){let t=this.dataWrapper.get("node.connectorGap"),e=this.width/2,n=this.height/2;yield{x:-(t+e),y:0,dir:"left"},yield{x:e+t,y:0,dir:"right"},yield{x:0,y:-(t+n),dir:"top"},yield{x:0,y:t+n,dir:"bottom"}}*getResizerPosition(){let t=this.width/2,e=this.height/2;yield[-t,-e,"nw-resize"],yield[0,-e,"n-resize"],yield[t,-e,"ne-resize"],yield[-t,0,"w-resize"],yield[t,0,"e-resize"],yield[-t,e,"sw-resize"],yield[0,e,"s-resize"],yield[t,e,"se-resize"]}_create(){this._createComments(),this._createResizer(),this._createConnector()}_getLabelXY(t){let e=this.dataWrapper.get("fontSize");return{x:0,y:e-(e+pe)*t.length/2}}_getLabelRect(){let t=this.width,e=this.height;return{x:-(t/2),y:-(e/2),width:t+20,height:e}}render(){let t=this.data["node.x"]+this.data["node.width"]/2,e=this.data["node.y"]+this.data["node.height"]/2;this.group.attr("transform",`translate(${t}, ${e})`),super.render(),this._renderComments(),this._renderResizer(),this._renderConnector()}};var _r=30,wr=30,Aa=new Set(["TopLeft","TopCenter","TopRight","BottomLeft","BottomCenter","BottomRight"]),Oe=class extends pt{constructor(t,e,n){super(t,e,n),this.renderer=e}get startX(){return this.x}get startY(){return this.y}get resizerEnabled(){return this.data["node.resizerEnabled"]===!0}get isConnectorEnabled(){return this.data["node.connectorEnabled"]===!0}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}get x(){return this.data["node.x"]}get y(){return this.data["node.y"]}get width(){return this.data["node.width"]}get height(){return this.data["node.height"]}get endX(){return this.x+this.width}get endY(){return this.y+this.height}set x(t){this.data["node.x"]=t}set y(t){this.data["node.y"]=t}set width(t){this.data["node.width"]=t}set height(t){this.data["node.height"]=t}create(){super.create()}getPositionXY(t){switch(t){case"left":return{x:this.x,y:this.y+this.height/2};case"right":return{x:this.x+this.width,y:this.y+this.height/2};case"top":return{x:this.x+this.width/2,y:this.y};case"bottom":return{x:this.x+this.width/2,y:this.y+this.height};default:throw new Error(`Invalid argument '${t}'`)}}fitSizeOnText(){let t=gr(this.data),e=ge*2;this.width=t.width+e,this.height=t.height+e}resizeToNorth(t){let e=-(this.height/2),n=parseInt(e-t);this.height+n>=wr?(this.y-=n/2,this.height=this.height+n/2):(this.y+=this.height-wr,this.height=wr)}resizeToWest(t){let e=-(this.width/2),n=parseInt(e-t);this.width+n>=_r?(this.x-=n/2,this.width=this.width+n/2):(this.x+=this.width-_r,this.width=_r)}addComment(t,e,n){if(!Aa.has(e))throw new Error(`Unknown position value '${e}' Please call with 'TopLeft' or 'TopCenter' or 'TopRight' or 'BottomLeft' or 'BottomCenter' or 'BottomRight'`);let i=`node.comment${e}`;n&&(i+=`.${n}`),this.data[i]=t}resizeToEast(t){this.width=Math.max(_r,parseInt(t+this.width/2))}resizeToSouth(t){this.height=Math.max(wr,parseInt(t+this.height/2))}};var Jg=new Ye("Flowchart::ObjectManager"),Se=class{constructor(){this.mapList=eo.range(0,3).map(()=>new Map),this.objMap={node:this.mapList[0],connection:this.mapList[1],group:this.mapList[2]}}getMap(t){let e=this.objMap[t];if(e===void 0)throw objMngLogger.error("ObjectManager.getMap()",`Unknown '${t}' type`),new Error(`Unknown '${t}' type`);return e}getObjCount(){return this.mapList.reduce((t,e)=>t+e.size,0)}add(t){let e=this.getMap(t.type);if(e.has(t.id))throw new Error(`Already has objId '${t.id}'`);e.set(t.id,t)}remove(t){let e=this.getMap(t.type);e.has(t.id)&&e.delete(t.id)}*getMapIterator(){yield*this.mapList}getNodeIterator(){return this.mapList[0].values()}getConnectionIterator(){return this.mapList[1].values()}getGroupIterator(){return this.mapList[2].values()}findOrNull(t){for(let e of this.getMapIterator())if(e.has(t))return e.get(t);return null}clear(){this.mapList.forEach(t=>t.clear())}*getAllObjIterator(){for(let t of this.mapList)yield*t.values()}*getSelectedObjIterator(){for(let t of this.getAllObjIterator())t.isSelected&&(yield t)}getParentGroupOrNull(t){for(let e of this.getGroupIterator())if(e.hasObjId(t.id))return e;return null}*getConnectedConnections(t){for(let e of this.getConnectionIterator())!e.isTempObj&&(e.sourceObjId===t||e.destinationObjId===t)&&(yield e)}reassignId(t,e,n){let i=this.getMap(t.type);i.delete(e),i.set(n,t)}};var Ce=class{constructor(t,e,n){this.actionController=t,this.objectManager=e,this.icontainer=n,this.movedInfo=[]}moveStartHandler(){this.icontainer.getLogger().debug("MoveHandler.moveStartHandler()","start"),this.movedInfo=[];for(let t of this.objectManager.getSelectedObjIterator()){let e=new V(t.data);e.addMoveOldValues(),this.movedInfo.push(e)}}moveEndHandler(){this.icontainer.getLogger().debug("MoveHandler.moveEndHandler()","end"),this.movedInfo.forEach(e=>e.updateMoveNewValues()),this.movedInfo.filter(e=>e.propList.some(n=>ro.isEqual(n.oldValue,n.newValue)===!1)).length>0&&this.actionController.addAction(new W(this.movedInfo,this.icontainer))}};var no=Tt(zt());var ke=class{constructor(t,e,n){this.actionController=t,this.objectManager=e,this.icontainer=n,this.resizeInfo=[]}resizeCallback(t,e,n,i){for(let o of this.objectManager.getNodeIterator())if(o.isSelected&&o.id!=t&&o.resizerEnabled){let s=o.height/2,a=o.width/2;switch(e){case"n-resize":o.resizeToNorth(-(s+i));break;case"nw-resize":o.resizeToNorth(-(s+i)),o.resizeToWest(-(a+n));break;case"ne-resize":o.resizeToNorth(-(s+i)),o.resizeToEast(a+n);break;case"w-resize":o.resizeToWest(-(a+n));break;case"e-resize":o.resizeToEast(a+n);break;case"s-resize":o.resizeToSouth(s+i);break;case"sw-resize":o.resizeToSouth(s+i),o.resizeToWest(-(a+n));break;case"se-resize":o.resizeToSouth(s+i),o.resizeToEast(a+n);break;default:throw new Error(`Unknown cursor type '${e}'`)}}for(let o of this.objectManager.getGroupIterator())o.isSelected&&o.render()}resizeDragStart(){this.icontainer.getLogger().debug("ResizeHandler.resizeDragStart()","start"),this.resizeInfo=[];for(let t of this.objectManager.getNodeIterator())if(t.isSelected){let e=new V(t.data);e.addSizeOldValues(),this.resizeInfo.push(e)}}resizeDragEnd(){this.icontainer.getLogger().debug("ResizeHandler.resizeDragEnd()","end"),this.resizeInfo.forEach(e=>e.updateSizeNewValues()),this.resizeInfo.filter(e=>e.propList.some(n=>no.isEqual(n.oldValue,n.newValue)===!1)).length>0&&this.actionController.addAction(new W(this.resizeInfo,this.icontainer))}addDragActionOnResizer(t){t.renderer.resizers.forEach(e=>{let n=e.attr("cursor");e.call(K().filter(()=>this.icontainer.getReadOnly()===!1).on("start",()=>{this.resizeDragStart(),this.icontainer.initDrag("drag-node-resize")}).on("drag",i=>{let o=i.x,s=i.y,a=t.width,l=t.height;switch(n){case"nw-resize":t.resizeToNorth(s),t.resizeToWest(o);break;case"n-resize":t.resizeToNorth(s);break;case"ne-resize":t.resizeToNorth(s),t.resizeToEast(o);break;case"w-resize":t.resizeToWest(o);break;case"e-resize":t.resizeToEast(o);break;case"sw-resize":t.resizeToSouth(s),t.resizeToWest(o);break;case"s-resize":t.resizeToSouth(s);break;case"se-resize":t.resizeToSouth(s),t.resizeToEast(o);break;default:throw new Error(`Unknown cursor type '${n}'`)}let c=t.width-a,h=t.height-l;this.resizeCallback(t.id,n,c,h)}).on("end",()=>{this.resizeDragEnd(),this.icontainer.terminateDrag("drag-node-resize")}))})}};var io={text:""},vr={_queryPermission(r){return navigator.permissions.query({name:r}).then(t=>t).catch(()=>({state:"error"}))},checkClipboardPermission(){return vt(this,null,function*(){try{let r=yield this._queryPermission("clipboard-write"),t=yield this._queryPermission("clipboard-read");return r.state==="granted"&&t.state==="granted"}catch(r){return!1}})},saveData(r){io.text=r},loadData(){return io.text}};var Da=10,Na=10,je=class{constructor(t){this.icontainer=t,this.tmpOut=!1,this.tooltip={objId:null,mouseOverTimer:null,mouseOutTimer:null,g:null,textCache:new Mt},this.isfirefox=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}commonOverOutAction(t){let e=0,n=0;t.g.on("mousemove",i=>{e=(this.isfirefox?i.layerX:i.offsetX)+Da,n=(this.isfirefox?i.layerY:i.offsetY)+Na}).on("mouseover",()=>{t.isHovered=!0,this.icontainer.getSelectNodeOnHover()&&t.type==="node"&&(this.icontainer.releaseAllObjects(),t.select(!0)),!(this.icontainer.getTooltipHidden()||!t.canShowTooltip)&&(this.tooltip.mouseOutTimer!=null&&this.tooltip.mouseOutTimer.stop(),this.tooltip.mouseOverTimer=kt(()=>{t.isHovered&&t.onEditing===!1&&t.id!==this.tooltip.objId&&!this.icontainer.getTooltipHidden()&&this.createTooltipObj(t.data,e,n)},500))}).on("mouseout",()=>{t.isHovered=!1,!(this.icontainer.getTooltipHidden()||!t.canShowTooltip)&&(this.tooltip.mouseOverTimer!=null&&this.tooltip.mouseOverTimer.stop(),this.tooltip.mouseOutTimer=kt(()=>{t.isHovered||this.removeTooltipObj()},200))})}createTooltipObj(t,e,n){this.removeTooltipObj(),this.tooltip.objId=t.id,this.tooltip.g=this.icontainer.getSvg().append("g").attr("class","tooltip");let i=this.icontainer.getObjectOrNull(this.tooltip.objId);if(i===null)return;let o={text:i.getDataOrNull("tooltipText"),foreColor:i.getDataOrNull("tooltipForeColor"),fontFamily:i.getDataOrNull("tooltipFontFamily"),fontSize:i.getDataOrNull("tooltipFontSize"),textDecoration:i.getDataOrNull("tooltipTextDecoration"),padding:i.getDataOrNull("tooltipPadding"),fill:i.getDataOrNull("tooltipFill"),borderColor:i.getDataOrNull("tooltipBorderColor"),borderWidth:i.getDataOrNull("tooltipBorderWidth"),borderDash:i.getDataOrNull("tooltipBorderDash"),width:0},s=gr(o);o.width=Math.min(s.width,i.data.tooltipMaxWidth);let a=me(o);this.tooltip.g.append("rect").attr("x",e).attr("y",n).attr("width",o.width+o.padding*2).attr("height",a.lineHeight*a.length+o.padding*2).attr("fill",o.fill).attr("stroke",o.borderColor).attr("stroke-width",o.borderWidth).attr("stroke-dasharray",o.borderDash);let l=this.tooltip.g.append("text").attr("fill",o.foreColor).attr("fontSize",o.fontSize).attr("text-decoration",o.textDecoration);yr(l,a,e+o.padding,n+o.padding+o.fontSize,o)}removeTooltipObj(){this.tooltip.g!==null&&(this.tooltip.g.remove(),this.tooltip.objId=null,this.tooltip.g=null,this.tooltip.textCache.clear())}addMouseAction(t){this.commonOverOutAction(t)}};var Yt=class{constructor(t,e,n,i){this.startX=t,this.startY=e,this.endX=n,this.endY=i}isContained(t,e){return t>=this.startX&&t<=this.endX&&e>=this.startY&&e<=this.endY}};var Me=class extends ${constructor(t,e){super(t,"bridge",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.width,n=this.height;this.objects.body.attr("x",-(e/2)).attr("y",-(n/2)).attr("rx",(e+n)/6).style("width",`${e}px`).style("height",`${n}px`).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke",t.get("borderColor")).attr("stroke-dasharray",t.get("borderDash"))}};var $t=15,Pa=-4,Ra=2,Ee=class extends ${constructor(t,e){super(t,"comment",e)}_create(){this.objects.body=this.group.append("path").attr("class","body").classed(this.data.type,!0),super._create()}_getPath(){let t=[],e=this.width/2,n=this.height/2,i=-e,o=-n;return t.push(`M${i} ${o}`),t.push(`L${e-$t} ${o}`),t.push(`L${e},${o+$t}`),t.push(`L${e},${n}`),t.push(`L${i},${n}`),t.push("Z"),t.push(`M${e-$t} ${o}`),t.push(`L${e-($t+Pa)} ${o+($t+Ra)}`),t.push(`L${e} ${o+$t}`),t.join(" ")}_render(){let t=this.dataWrapper;this.objects.body.attr("d",this._getPath()).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke",t.get("borderColor")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var oo=.28,Ie=class extends ${constructor(t,e){super(t,"db",e)}_create(){this.objects.circle=this.group.append("ellipse"),this.objects.body=this.group.append("path"),super._create()}get circleHeight(){return this.height*oo}_getPath(){let t=[],e=this.height/2,n=this.circleHeight/2,i=this.width/2,o=-i,s=i,a=-e+n,l=e-n;return t.push(`M${o} ${a}`),t.push(`A${i} ${n} 0 0 0 ${s} ${a}`),t.push(`V${l}`),t.push(`A${i} ${n} 0 0 1 ${o} ${l}`),t.push(`V${a}`),t.join(" ")}_render(){let t=this.dataWrapper,e=this.circleHeight/2,n=this.width/2,o=-(this.height/2)+e,s={fill:t.get("node.fill"),borderWidth:t.get("borderWidth"),borderColor:t.get("borderColor"),borderDash:t.get("borderDash")};this.objects.circle.attr("cx",0).attr("cy",o).attr("rx",n).attr("ry",e).style("fill",s.fill).style("stroke-width",s.borderWidth).attr("stroke",s.borderColor).attr("stroke-dasharray",s.borderDash),this.objects.body.attr("d",this._getPath()).style("fill",s.fill).style("stroke-width",s.borderWidth).attr("stroke",s.borderColor).attr("stroke-dasharray",s.borderDash);let a=this.height*oo;this._createText(0,a/2)}};var Et=class extends ft{constructor(t,e,n){super(t,e,n),this.markerId=`${this.iContainer.getUUID()}_marker_${this.data.id}`,this.objects.marker=this.group.append("svg:defs").append("svg:marker").attr("id",this.markerId),this.objects.markerPath=this.objects.marker.append("path"),this.checkChanged={points:null,srcX:0,srcY:0,desX:0,desY:0}}get width(){return this.data["connection.width"]}get height(){return 0}get lastPointId(){return this.data["connection.points"].length-1}create(){super.create(),this.bringToFrontElement(this.objects.sourceConnector.node()),this.bringToFrontElement(this.objects.destinationConnector.node())}_createConnector(){this.objects.sourceConnector=this.group.append("circle").attr("cursor","crosshair"),this.objects.destinationConnector=this.group.append("circle").attr("cursor","crosshair")}_getPosLocation(t,e){let n=0,i=0;switch(e){case"left":n=-(t.width/2);break;case"right":n=t.width/2;break;case"top":i=-(t.height/2);break;case"bottom":i=t.height/2;break;default:throw new Error(`Invalid argument '${e}'`)}return{x:n,y:i}}_getBBox(){return this.objects.text.node().getBBox()}_getLabelRect(){let t=this._getBBox(),e=t.width+10,n=t.height+10;return{x:parseFloat(this.objects.text.attr("x"))-e/2,y:parseFloat(this.objects.text.attr("y"))-5-this.data.fontSize,width:e+20,height:Math.max(n,this.data.fontSize+10)}}_renderMarker(){let t=this.dataWrapper,e={borderWidth:t.get("borderWidth"),arrowSize:t.get("connection.arrowSize"),arrowFill:t.get("connection.arrowFill"),arrowBorderColor:t.get("connection.arrowBorderColor"),arrowBorderWidth:t.get("connection.arrowBorderWidth")},n=e.arrowSize/e.borderWidth;this.objects.marker.attr("refX",n).attr("refY",n/2).attr("markerWidth",n).attr("markerHeight",n).attr("orient","auto"),this.objects.markerPath.attr("d",`M 0 0 L ${n} ${n/2} L 0 ${n} z`).attr("fill",e.arrowFill).attr("stroke",e.arrowBorderColor).attr("stroke-width",e.arrowBorderWidth/e.borderWidth)}_renderConnector(){let t=this.dataWrapper,e=this._getSourceLoc(),n=this._getDestinationLoc(),i={size:t.get("connection.connectorSize"),fill:t.get("connection.connectorFill")};this.objects.sourceConnector.attr("cx",e.x).attr("cy",e.y).attr("r",i.size).attr("fill",i.fill).attr("visibility",this.subUiVisilbility),this.objects.destinationConnector.attr("cx",n.x).attr("cy",n.y).attr("r",i.size).attr("fill",i.fill).attr("visibility",this.subUiVisilbility)}_getSourceLoc(){return this._getNodePositionLoc(this.data["connection.sourceObjId"],this.data["connection.sourcePos"],0)}_getDestinationLoc(){return this._getNodePositionLoc(this.data["connection.destinationObjId"],this.data["connection.destinationPos"],this.lastPointId)}_recordLastInfo(t,e){this.checkChanged.points=this.data["connection.points"],this.checkChanged.srcX=t.x,this.checkChanged.srcY=t.y,this.checkChanged.desX=e.x,this.checkChanged.desY=e.y}_updatePoints(...t){this.data["connection.points"]===void 0||this.data["connection.points"]===null?this.data["connection.points"]=[]:this.data["connection.points"].splice(0,this.data["connection.points"].length),t.forEach(e=>this.data["connection.points"].push(e))}_isChanged(t,e){try{let n=this.checkChanged.srcX-this.checkChanged.desX,i=t.x-e.x,o=this.checkChanged.srcY-this.checkChanged.desY,s=t.y-e.y;return n!==i||o!==s}finally{this._recordLastInfo(t,e)}}_getNodePositionLoc(t,e,n){if(t&&e){let i=this.iContainer.getObjectOrNull(t);if(i===null)return this.data["connection.points"]&&this.data["connection.points"].length>n?{x:this.data["connection.points"][n].x,y:this.data["connection.points"][n].y}:{x:0,y:0};{let o=this._getPosLocation(i,e),s=Ui(i.renderer.group.attr("transform"));return{x:o.x+s.translateX,y:o.y+s.translateY}}}else{if(this.data["connection.points"]&&this.data["connection.points"].length>n)return{x:this.data["connection.points"][n].x,y:this.data["connection.points"][n].y};throw new Error("Invalid points value.")}}};var Te=class extends Et{constructor(t,e){super(t,"direct",e)}_create(){this.objects.line=this.group.append("line").attr("marker-end",`url(#${this.markerId})`),this.objects.wideLine=this.group.append("line").attr("class","wide-line").style("stroke","rgba(0, 0, 0, 0)"),this.objects.rect=this.group.append("rect"),this._createConnector()}_getLabelXY(t){let e=this._getSourceLoc(),n=this._getDestinationLoc();return{x:e.x+(n.x-e.x)/2,y:e.y+(n.y-e.y)/2+(this.data.fontSize-this.data.fontSize*t.length/2)}}_render(){let t=this.dataWrapper,e=this.data["connection.points"],n=this._getSourceLoc(),i=this._getDestinationLoc(),o={borderColor:t.get("borderColor"),borderWidth:t.get("borderWidth"),borderDash:t.get("borderDash"),text:t.get("text"),fill:t.get("connection.textBorderFill"),textBorderColor:t.get("connection.textBorderColor"),textBorderWidth:t.get("connection.textBorderWidth"),textBorderDash:t.get("connection.textBorderDash")};if(this._renderConnector(),this._renderMarker(),this._isChanged(n,i)&&this._updatePoints(n,i),this.objects.line.attr("x1",e[0].x).attr("y1",e[0].y).attr("x2",e[this.lastPointId].x).attr("y2",e[this.lastPointId].y).style("stroke",o.borderColor).style("stroke-width",o.borderWidth).style("stroke-dasharray",o.borderDash),this.objects.wideLine.attr("x1",e[0].x).attr("y1",e[0].y).attr("x2",e[this.lastPointId].x).attr("y2",e[this.lastPointId].y).style("stroke-width",Math.max(o.borderWidth,5)),this._createText(),o.text){let s=this._getBBox(),a=s.width+10,l=s.height+10;this.objects.rect.attr("x",s.x-5).attr("y",s.y-5).attr("width",a).attr("height",l).style("fill",o.fill).style("stroke",o.textBorderColor).style("stroke-width",o.textBorderWidth).style("stroke-dasharray",o.textBorderDash)}else this.objects.rect.style("fill","transparent").style("stroke","transparent")}};var Or=20,It=10,so=It/2,ze=class extends Et{constructor(t,e){super(t,"elbow",e),this.adjusterList=[],this.elbowMap={top:this._topTo,bottom:this._bottomTo,left:this._leftTo,right:this._rightTo}}_create(){this.objects.polyline=this.group.append("polyline").attr("fill","none").attr("marker-end",`url(#${this.markerId})`),this.objects.wideLine=this.group.append("polyline").attr("fill","none").style("stroke","rgba(0, 0, 0, 0)"),this.objects.rect=this.group.append("rect"),this._createConnector();let t=this.data["connection.points"];t.length===2?this.refreshAdjustList():(this._recordLastInfo(this._getSourceLoc(),this._getDestinationLoc()),this._createAdjustList(t.slice(1,t.length-1)))}_getNextXY(t,e){switch(t){case"left":return{x:e.x-Or,y:e.y};case"right":return{x:e.x+Or,y:e.y};case"top":return{x:e.x,y:e.y-Or};case"bottom":return{x:e.x,y:e.y+Or};default:throw new Error(`Unknown pos '${t}'`)}}*_topTo(t,e,n,i,o){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,l=(n.x+i.x)/2,c=(n.y+i.y)/2;switch(o){case"top":{yield{x:s,y:Math.min(n.y,i.y)};break}case"bottom":{t.y>e.y?yield{x:s,y:a}:(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:a},yield{x:(s+i.x)/2,y:i.y});break}case"left":{t.x<e.x?t.y<e.y&&(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:c}):t.y<e.y?(yield{x:l,y:n.y},yield{x:i.x,y:c}):(yield{x:l,y:a},yield{x:i.x,y:(a+i.y)/2});break}case"right":{t.x<e.x?t.y<e.y?(yield{x:l,y:n.y},yield{x:i.x,y:c}):(yield{x:l,y:a},yield{x:i.x,y:(a+i.y)/2}):t.y<e.y&&(yield{x:(n.x+s)/2,y:n.y},yield{x:s,y:c});break}default:throw new Error(`Unknown pos '${o}'`)}}*_bottomTo(t,e,n,i,o){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,l=(n.x+i.x)/2,c=(n.y+i.y)/2;switch(o){case"top":{t.y<e.y?yield{x:s,y:a}:(yield{x:(t.x+s)/2,y:n.y},yield{x:s,y:a},yield{x:(s+i.x)/2,y:i.y});break}case"bottom":{yield{x:s,y:Math.max(n.y,i.y)};break}case"left":{t.y<e.y?t.x>e.x&&(yield{x:l,y:a},yield{x:i.x,y:(a+i.y)/2}):(yield{x:l,y:n.y},yield{x:i.x,y:c});break}case"right":{if(t.y<e.y){if(t.x<e.x){let h=(n.y+c)/2;yield{x:l,y:h},yield{x:i.x,y:(h+i.y)/2}}}else yield{x:l,y:n.y},yield{x:i.x,y:c};break}default:throw new Error(`Unknown pos '${o}'`)}}*_leftTo(t,e,n,i,o){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,l=(n.x+i.x)/2,c=(n.y+i.y)/2;switch(o){case"top":{t.y<e.y?t.x<e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:a}):t.x<e.x?(yield{x:n.x,y:c},yield{x:l,y:i.y}):(yield{x:s,y:c},yield{x:(s+i.x)/2,y:i.y});break}case"bottom":{t.y<e.y?t.x<e.x?(yield{x:n.x,y:c},yield{x:l,y:i.y}):(yield{x:s,y:c},yield{x:(s+i.x)/2,y:i.y}):t.x<e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:a});break}case"left":{t.x<e.x?yield{x:n.x,y:a}:yield{x:i.x,y:a};break}case"right":{t.x<e.x?(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:a},yield{x:i.x,y:(a+i.y)/2}):yield{x:s,y:a};break}default:throw new Error(`Unknown pos '${o}'`)}}*_rightTo(t,e,n,i,o){let s=(t.x+e.x)/2,a=(t.y+e.y)/2,l=(n.x+i.x)/2,c=(n.y+i.y)/2;switch(o){case"top":{t.y<e.y?t.x>e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:(a+i.y)/2}):t.x<e.x?(yield{x:s,y:c},yield{x:(s+i.x)/2,y:i.y}):(yield{x:n.x,y:c},yield{x:l,y:i.y});break}case"bottom":{t.y<e.y?t.x<e.x?(yield{x:s,y:c},yield{x:(s+i.x)/2,y:i.y}):(yield{x:n.x,y:c},yield{x:l,y:i.y}):t.x>e.x&&(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:a});break}case"left":{t.x<e.x?yield{x:s,y:a}:(yield{x:n.x,y:(n.y+a)/2},yield{x:l,y:a},yield{x:i.x,y:(a+i.y)/2});break}case"right":{yield{x:Math.max(n.x,i.x),y:a};break}default:throw new Error(`Unknown pos '${o}'`)}}_getElbowPoints(t,e,n,i){let o=this._getNextXY(n,t),s=this._getNextXY(i,e),a=[],l=this.elbowMap[n];if(a.push({x:t.x,y:t.y}),l===void 0)console.error(`unknown position value '${n}'`);else for(let c of l(t,e,o,s,i))a.push(c);return a.push({x:e.x,y:e.y}),a}_getPolylinePath(t){let e=[],n=t[0].x,i=t[0].y,o=this._getFirstPointDir()==="v";e.push([n,i]);for(let s=0;s<t.length-1;++s)o?i=t[s+1].y:n=t[s+1].x,e.push([n,i]),o=!o;return e.push([t[t.length-1].x,t[t.length-1].y]),e}_getLabelPos(t){let e=t[1],n=t[2];return{x:(e[0]+n[0])/2,y:(e[1]+n[1])/2}}_getPosToDir(t){switch(t){case"top":case"bottom":return"v";case"left":case"right":return"h";default:throw new Error(`Unknown sourcePos '${t}'`)}}_getFirstPointDir(){if(this.data["connection.sourcePos"]!==null)return this._getPosToDir(this.data["connection.sourcePos"]);{let t=this._getPos(this._getSourceLoc(),this._getDestinationLoc());return this._getPosToDir(t.srcPos)}}_createAdjustList(t){let e=this.data,n=this._getFirstPointDir()==="v";this.adjusterList.forEach(i=>i.remove()),this.adjusterList.splice(0,this.adjusterList.length),t.forEach((i,o)=>{let s=!n,a=0,l=0,c=null;n=!n;let h=this.group.append("rect").attr("x",i.x-It/2).attr("y",i.y-It/2).attr("width",It).attr("height",It).attr("class","adjuster").attr("cursor","move").call(K().filter(()=>this.icontainer.getReadOnly()===!1).on("start",p=>{a=p.x,l=p.y,c=mr(this.data["connection.points"])}).on("drag",p=>{let f=e["connection.points"],m=f[o+1];if(s){let S=a-p.x;m.x-=S,a=p.x,h.attr("x",m.x-It/2),o>0&&(f[o].x-=S/2),o+3<f.length&&(f[o+2].x-=S/2)}else{let S=l-p.y;m.y-=S,l=p.y,h.attr("y",m.y-It/2),o>0&&(f[o].y-=S/2),o+3<f.length&&(f[o+2].y-=S/2)}this._render()}).on("end",()=>{this.icontainer.adjDragCallback(this.data,c,mr(this.data["connection.points"]))}));this.adjusterList.push(h)})}_getPos(t,e){let n={srcPos:this.data["connection.sourcePos"],desPos:this.data["connection.destinationPos"]},i=Math.abs(t.y-e.y),o=Math.abs(t.x-e.x);return n.srcPos||(i>o?n.srcPos=t.y>e.y?"top":"bottom":n.srcPos=t.x>e.x?"left":"right"),n.desPos||(i>o?n.desPos=t.y>e.y?"bottom":"top":n.desPos=t.x>e.x?"right":"left"),n}refreshAdjustList(){let t=this._getSourceLoc(),e=this._getDestinationLoc(),n=this._getPos(t,e),i=this._getElbowPoints(t,e,n.srcPos,n.desPos);this._createAdjustList(i.slice(1,i.length-1)),this._updatePoints(...i)}_getLabelXY(t){let e=this._getLabelPos(this._getPolylinePath(this.data["connection.points"]));return{x:e.x,y:e.y+(this.data.fontSize-this.data.fontSize*t.length/2)}}_renderAdjustList(){this.adjusterList.forEach((t,e)=>{let n=this.data["connection.points"][e+1];t.attr("x",n.x-so).attr("y",n.y-so),t.attr("visibility",this.group.classed("edit")===!1?this.subUiVisilbility:"hidden"),this.bringToFrontElement(t.node())})}_render(){let t=this.data,e=this.dataWrapper,n=this._getSourceLoc(),i=this._getDestinationLoc();this._isChanged(n,i)&&this.refreshAdjustList(),this._renderConnector(),this._renderMarker(),this._renderAdjustList();let s=this._getPolylinePath(t["connection.points"]).map(a=>`${a[0]},${a[1]}`).join(", ");if(this.objects.polyline.attr("points",s).style("stroke",e.get("borderColor")).style("stroke-width",e.get("borderWidth")).style("stroke-dasharray",e.get("borderDash")),this.objects.wideLine.attr("points",s).style("stroke-width",Math.max(e.get("borderWidth"),5)),this._createText(),t.text){let a=this._getBBox(),l=a.width+10,c=a.height+10;this.objects.rect.attr("x",a.x-5).attr("y",a.y-5).attr("width",l).attr("height",c).style("fill",e.get("connection.textBorderFill")).style("stroke",e.get("connection.textBorderColor")).style("stroke-width",e.get("connection.textBorderWidth")).style("stroke-dasharray",e.get("connection.textBorderDash"))}else this.objects.rect.style("fill","transparent").style("stroke","transparent")}};var Ae=class extends ft{constructor(t,e){super(t,"group",e)}_create(){this.objects.rect=this.group.append("rect").attr("fill","none").attr("visibility","hidden"),this.objects.thickRect=this.group.append("rect").attr("fill","none").attr("opacity","0").attr("visibility","hidden")}_render(){let t=this.data["group.rect"],e=this.dataWrapper;if(this.data.isSelected||this.data["group.borderAlwaysAppearance"]){let n=e.get("borderWidth");this.objects.rect.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).attr("stroke",e.get("borderColor")).attr("stroke-width",n).attr("stroke-dasharray",e.get("borderDash")).attr("visibility","visible"),this.objects.thickRect.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).attr("stroke","white").attr("stroke-width",Math.max(n,8)).attr("visibility","visible")}else this.objects.rect.attr("visibility","hidden"),this.objects.thickRect.attr("visibility","hidden")}};var De=class extends ${constructor(t,e){super(t,"if",e)}_create(){this.objects.body=this.group.append("polygon"),super._create()}getPolygon(){let t=[],e=this.width/2,n=this.height/2;return t.push(`${-e},${0}`),t.push(`${0},${-n}`),t.push(`${e},${0}`),t.push(`${0},${n}`),t.join(" ")}_render(){let t=this.dataWrapper;this.objects.body.attr("points",this.getPolygon()).attr("fill",t.get("node.fill")).attr("stroke",t.get("borderColor")).attr("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var Ne=class extends ${constructor(t,e){super(t,"return",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.width,n=this.height;this.objects.body.attr("x",-(e/2)).attr("y",-(n/2)).attr("width",e).attr("height",n).style("fill",t.get("node.fill")).attr("stroke",t.get("borderColor")).style("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")),this._createText()}};var Pe=class extends ${constructor(t,e){super(t,"start",e)}_create(){this.objects.body=this.group.append("rect"),super._create()}_render(){let t=this.dataWrapper,e=this.objects,n=this.width,i=this.height;e.body.attr("x",-(n/2)).attr("y",-(i/2)).attr("rx",i/2).attr("width",n).attr("height",i).style("fill",t.get("node.fill")).style("stroke-width",t.get("borderWidth")).attr("stroke-dasharray",t.get("borderDash")).attr("stroke",t.get("borderColor")),this._createText()}};var Re=class{constructor(){this.nodeRenderMap=new Map,this.connectionRenderMap=new Map,this.etcRenderMap=new Map,this.nodeRenderMap.set("start",Pe),this.nodeRenderMap.set("if",De),this.nodeRenderMap.set("return",Ne),this.nodeRenderMap.set("comment",Ee),this.nodeRenderMap.set("bridge",Me),this.nodeRenderMap.set("db",Ie),this.connectionRenderMap.set("direct",Te),this.connectionRenderMap.set("elbow",ze),this.etcRenderMap.set("group",Ae)}_add(t,e,n){t.set(e,n)}_get(t,e){if(t.has(e))return t.get(e);throw new Error(`There is no renderer (key: '${e}')`)}addRenderMap(t,e,n){switch(t){case"node":this._add(this.nodeRenderMap,e,n);break;case"connection":this._add(this.connectionRenderMap,e,n);break;default:throw new Error(`Unknown type '${t}'`)}}getRenderConstructor(t,e){switch(t){case"node":return this._get(this.nodeRenderMap,e);case"connection":return this._get(this.connectionRenderMap,e);default:return this._get(this.etcRenderMap,e)}}changeRender(t,e,n){let i=this.getRenderConstructor(t.type,e),o=new i(t.data,n);t.changeRender(e,o)}};var Le=class{constructor(t){this.objSeq=0,this.clickSeq=0,this.icontainer=t,this.clear()}clear(){this.clearObjSeq(),this.clearClickSeq()}clearObjSeq(){this.objSeq=1}clearClickSeq(){this.clickSeq=0}getObjSeqId(){for(;this.icontainer.getObjectOrNull(this.objSeq)!==null;)++this.objSeq;return this.objSeq}increaseClickSeq(){return++this.clickSeq}};var ao={id:null,type:"",render:"",text:"",editable:!0,foreColor:"black",fontSize:16,fontFamily:"Noto Sans KR",textDecoration:"none",visibleOverText:!0,opacity:1,cursor:"move",borderColor:"black",borderWidth:1,borderDash:0,isSelected:!1,isMonitoring:!0,isHovered:!1,tooltipText:"",tooltipFontFamily:"Noto Sans KR",tooltipFontSize:12,tooltipForeColor:"black",tooltipFill:"white",tooltipBorderColor:"#bbb",tooltipBorderWidth:1,tooltipBorderDash:0,tooltipMaxWidth:380,tooltipPadding:10,tooltipTextDecoration:"none",tooltipVisible:!0,"borderWidth.selected":2,"borderColor.selected":"blue","node.width":120,"node.height":60,"node.fill":"white","node.x":0,"node.y":0,"node.connectorGap":0,"node.connectorSize":5,"node.resizerEnabled":!0,"node.connectorEnabled":!0,"node.commentTopLeft":"","node.commentTopCenter":"","node.commentTopRight":"","node.commentBottomLeft":"","node.commentBottomCenter":"","node.commentBottomRight":"","node.commentFontSize":10,"node.commentForeColor":"black","node.commentFontFamily":"Noto Sans KR","connection.points":[],"connection.sourceObjId":null,"connection.sourcePos":null,"connection.destinationObjId":null,"connection.destinationPos":null,"connection.width":200,"connection.arrowBorderColor":"black","connection.arrowBorderWidth":1,"connection.arrowFill":"black","connection.arrowSize":10,"connection.textBorderColor":"black","connection.textBorderWidth":1,"connection.textBorderDash":1,"connection.textBorderFill":"white","connection.connectorFill":"black","connection.connectorSize":3,"connection.adjusterSize":7,"connection.adjusterFill":"black","group.margin":20,"group.borderAlwaysAppearance":!1};var Sr=10,La=255,Cr=["left","right","top","bottom"],lo=.4,co=3,Xa=new Set(["isHovered","isSelected"]),Y={CLICK:"click",CLICK_NODE:"clickNode",DOUBLE_CLICK_NODE:"dblClickNode",CLICK_CONNECTION:"clickConnection",DOUBLE_CLICK_CONNECTION:"dblClickConnection",NEW_OBJECT:"newObject",REMOVE_OBJECT:"removeObject",SELECT_OBJECT:"selectObject",RELEASE_OBJECT:"releaseObject",UNDO:"undo",REDO:"redo",COMMAND:"command",CHANGE_CLASS:"changeClass",DISCONNECT_NODE:"disconnectNode",CONNECT_NODE:"connectNode",MOUSEUP_SHEET:"mouseUpSheet"},Ha=r=>{let t={};return{emit:(e,n)=>{!t[e]||t[e].forEach(i=>i.apply(r,n))},on:(e,n)=>(t[e]||(t[e]=[]),t[e].push(n),n),off:(e,n)=>{if(!t[e])return!1;let i=t[e].indexOf(n);return i<0?!1:(t[e].splice(i,1),!0)}}},Ya=r=>{let t=document.createElement("div"),e=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.classList.add("flowchart"),t.tabIndex=0,e.innerHTML=`<defs>
    <pattern
        id="${r}_small_grid"
        width="10"
        height="10"
        patternUnits="userSpaceOnUse">
        <path
        d="M 10 0 L 0 0 0 10"
        fill="none"
        stroke="gray"
        stroke-width="0.5"/>
    </pattern>
    <pattern
        id="${r}_grid"
        width="100"
        height="100"
        patternUnits="userSpaceOnUse">
        <rect
        width="100"
        height="100"
        fill="url(#${r}_small_grid)"/>
        <path
        d="M 100 0 L 0 0 0 100"
        fill="none"
        stroke="gray"
        stroke-width="1"/>
    </pattern>
</defs>`,t.appendChild(e),{div:t,svg:e}},ho=class extends rn{constructor({contextElement:t,width:e,height:n}){super({contextElement:t}),this._wheelZoom=!0,this._gridMode=!1,this._editMode=!1,this._readonly=!1,this._simpleConnectingMode=!1,this._moveScreenOnSelect=!1,this._selectNodeOnHover=!1,this._tooltipHidden=!1,this._traceMode=!1,this._singleSelection=!1,this._isChanged=!1,this.keyMap={},this.keyMap.ArrowLeft=()=>this.handleKeydownArrows(-10,0),this.keyMap.ArrowRight=()=>this.handleKeydownArrows(10,0),this.keyMap.ArrowDown=()=>this.handleKeydownArrows(0,10),this.keyMap.ArrowUp=()=>this.handleKeydownArrows(0,-10),this.keyMap.Delete=()=>this.handleKeydownDelete(),this.keyMap.Escape=()=>this.handleKeydownEscape(),this.keyMap.F2=()=>this.handleKeydownF2(),this.keyMap["^x"]=()=>this.cut(),this.keyMap["^c"]=()=>this.copy(),this.keyMap["^v"]=()=>this.paste(),this.keyMap["^z"]=()=>this.undoAction(),this.keyMap["^y"]=()=>this.redoAction(),this.keyMap["^a"]=()=>this.selectAllObjects(),this.keyMap["^A"]=()=>this.selectAllObjects(),this._appendMode={mode:null,data:null,dragged:!1},this._size={width:0,height:0},this._wrapperSize={width:0,height:0},this._svgSize={width:0,height:0},this._appendingObject=null,this.emitter=Ha(this);let{div:i,svg:o}=Ya(this.uuid);this.div=i,i.addEventListener("keydown",s=>{if(this._editMode||this._readonly){this.logger.debug("InnoFlowchart.handleKeydown()","Cancel because of editMode or readonly mode");return}let a=`${s.ctrlKey?"^":""}${s.key}`;a in this.keyMap&&(this.keyMap[a](s),s.preventDefault())}),this.addCoreElement(i),t.appendChild(i),this._initD3Elements(i,o,e,n),this._iContainer=new ye({releaseAllObjects:()=>this.releaseAllObjects(),addRenderObj:s=>this.add(s),removeObject:s=>this.remove(s),initDrag:s=>this._initDrag(s),terminateDrag:s=>this._terminateDrag(s),changeObjRender:(s,a)=>this._changeObjRender(s,a),adjDragCallback:(s,a,l)=>this._adjDragCallbackHandler(s,a,l),editTextCallback:(s,a,l)=>this._editTextCallbackHandler(s,a,l),editTextModeCallback:s=>this._editTextModeCallback(s),renderCallback:s=>this._renderCallBack(s),observerCallback:s=>this._observerCallback(s),selectCallback:(s,a,l)=>this._selectCallbackHandler(s,a,l),releaseCallback:(s,a)=>this._releaseCallbackHandler(s,a),setEditMode:s=>this._editMode=s,getLogger:()=>this.logger,getSvg:()=>this.d3Svg,getObjectOrNull:s=>this.getObjectOrNull(s),getSelectNodeOnHover:()=>this._selectNodeOnHover,getTooltipHidden:()=>this._tooltipHidden,getReadOnly:()=>this._readonly,isAppending:()=>this._appendMode.mode==="append",getUUID:()=>this.uuid}),this._seqMng=new Le(this._iContainer),this._objectManager=new Se,this._actionController=new _e(La),this._moveHandler=new Ce(this._actionController,this._objectManager,this._iContainer),this._resizeHandler=new ke(this._actionController,this._objectManager,this._iContainer),this._renderManager=new Re,this._objMouseHandler=new je(this._iContainer),this.theme=q({},ao),this.defaultRule=qi,this.zoomTo(1),this.render()}get readonly(){return this._readonly}get simpleConnectingMode(){return this._simpleConnectingMode}get editMode(){return this._editMode}get gridMode(){return this._gridMode}get tooltipHidden(){return this._tooltipHidden}get moveScreenOnSelect(){return this._moveScreenOnSelect}get selectNodeOnHover(){return this._selectNodeOnHover}get wheelZoom(){return this._wheelZoom}get traceMode(){return this._traceMode}get singleSelection(){return this._singleSelection}set readonly(t){this._readonly=t,this.classedOnSvg(t,"readonly"),this.logger.info(`readonly property is changed to '${t}'`)}set simpleConnectingMode(t){this._simpleConnectingMode=t,this.classedOnSvg(t,"simple"),this.logger.info(`simpleConnectingMode property is changed to '${t}'`)}set editMode(t){this._editMode=t,this.classedOnSvg(t,"edit-mode"),this.logger.info(`editMode property is changed to '${t}'`)}set gridMode(t){this._gridMode=t,this.d3Grid.attr("visibility",this._gridMode?"visible":"hidden"),this.classedOnSvg(t,"grid"),this.logger.info(`gridMode property is changed to '${t}'`),this.render()}set tooltipHidden(t){this._tooltipHidden=t,this.classedOnSvg(t,"tooltip-hidden"),this.logger.info(`tooltipHidden property is changed to '${t}'`)}set moveScreenOnSelect(t){this._moveScreenOnSelect=t,this.classedOnSvg(t,"move-screen-on-select"),this.logger.info(`moveScreenOnSelect property is changed to '${t}'`)}set selectNodeOnHover(t){this._selectNodeOnHover=t,this.classedOnSvg(t,"select-node-on-hover"),this.logger.info(`selectNodeOnHover property is changed to '${t}'`)}set wheelZoom(t){this._wheelZoom=t,this.classedOnSvg(t,"wheel-zoom"),this.logger.info(`wheelZoom property is changed to '${t}'`)}set traceMode(t){this.logger.logLevel=t?"INFO":"ERROR",this._traceMode=t,this.classedOnSvg(t,"trace"),this.logger.info(`traceMode property is changed to '${t}'`)}set singleSelection(t){this._singleSelection=t,this.classedOnSvg(t,"single-select"),this.logger.info(`singleSelection property is changed to '${t}'`)}_initD3Elements(t,e,n,i){this.logger=Zi(this.uuid),t.addEventListener("contextmenu",l=>l.preventDefault());let o=isNaN(n)?n:`${n}px`,s=isNaN(i)?i:`${i}px`;this.d3Div=X(t).style("width",o).style("height",s).style("overflow","auto").style("position","relative").style("scrollbar-width","thin").style("outline",0),this.d3Svg=X(e).on("mousemove",l=>this._mouseMoveOnSheetHandler(l)).on("click",l=>this._clickOnSheetHandler(l)).call(K().filter(()=>this._editMode===!1).on("start",l=>this._dragController(l)).on("drag",l=>this._dragController(l)).on("end",l=>this._dragController(l))),this.d3Grid=this.d3Svg.append("g").attr("transform","translate(-1, -1)").attr("class","grid").append("rect").attr("width","100%").attr("height","100%").attr("fill",`url(#${this.uuid}_grid)`).attr("visibility","hidden"),this.d3Container=this.d3Svg.append("g").attr("class","container");let a=Ur().filter(l=>this._wheelZoom&&l.type==="wheel"&&l.ctrlKey).wheelDelta(l=>-l.deltaY*(l.deltaMode===1?.05:l.deltaMode?1:.002)).scaleExtent([lo,co]).on("zoom",l=>this.zoomTo(l.transform.k));this.d3Div.call(a).on("dblclick.zoom",null),this.selection={rect:null,startX:0,startY:0}}$emit(t,...e){this.emitter.emit(t,e)}$on(t,e){return this.emitter.on(t,e)}$off(t,e){return this.emitter.off(t,e)}moveWrapper(t){try{this._moveHandler.moveStartHandler(),t(),this._updateNegativePos()}finally{this._moveHandler.moveEndHandler(),this.refreshSvgSize()}}addSvgDefs(t){this.d3Svg.node().appendChild(t)}addLinearGradientDefs(t,e,n,i){if(typeof n.length!="number"||typeof i.length!="number")throw new Error("it must be an array type both offsets and colors!");let o=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");s.id=t,s.setAttribute("gradientTransform",`rotate(${e})`),uo.default.zip(n,i).forEach(([a,l])=>{let c=document.createElementNS("http://www.w3.org/2000/svg","stop");c.setAttribute("offset",a),c.setAttribute("stop-color",l),s.appendChild(c)}),o.appendChild(s),this.addSvgDefs(o)}add(t,e=void 0){switch(t.type){case void 0:throw this.logger.error("InnoFlowchart.add()","undefined type prop"),new Error("Object that you added needs 'type' property! (node or connection)");case"group":t.render="group";break;default:break}if(t.render===void 0)throw this.logger.error("InnoFlowchart.add()","undefined render prop"),new Error("Object that you added needs 'render' property!");if(t.id===void 0||t.id===null)t.id=this._seqMng.getObjSeqId();else switch(typeof t.id){case"number":case"string":break;default:throw this.logger.error("InnoFlowchart.add()","Not allowed id type (USE STRING OR NUMBER)"),new Error("Data's id is only allowed string or nubmer type!")}if(this._objectManager.findOrNull(t.id)!==null)throw this.logger.error("InnoFlowchart.add()","duplicated object id"),new Error(`Object's id is already created! (${t.id})`);this.defaultRule(t),Qr(t,this.theme);let n=null,i=this._renderManager.getRenderConstructor(t.type,t.render),o=new i(t,this._iContainer);switch(t.type){case"connection":n=new we(t,o,this._iContainer);break;case"node":n=new Oe(t,o,this._iContainer);break;case"group":n=new ve(t,o,this._iContainer);break;default:throw Error(`unkown data type '${t.type}'`)}return this._objectManager.add(n),n.create(),this.refreshSvgSize(),e!==void 0&&this.d3Container.node().insertBefore(n.g.node(),this._getChildElementOrNull(e)),t.temp?this.logger.debug("InnoFlowchart.add()",`created temp obj id is '${n.id}'`):(this._addObjectEvent(n),this.emitChangedStatus(),this.$emit(Y.NEW_OBJECT,n),this.logger.debug("InnoFlowchart.add()",`created obj id is '${n.id}'`)),n}remove(t){if(t==null)throw this.logger.error("InnoFlowchart.remove()","Object could not be null or undefined to remove!"),new Error("Object could not be null or undefined to remove!");let e=null;switch(typeof t){case"string":case"number":e=this.getObjectOrNull(t);break;case"object":e=this.getObjectOrNull(t.id);break;default:throw Error(`unkown data type '${typeof t}'`)}if(e!=null)e.destroy(),this.emitChangedStatus(),this._objectManager.remove(e),this.refreshSvgSize(),this._objMouseHandler.removeTooltipObj(),e.isTempObj?this.logger.debug("InnoFlowchart.remove()",`Removed temp obj id is '${e.id}'`):(this.$emit(Y.REMOVE_OBJECT,e),this.logger.debug("InnoFlowchart.remove()",`Removed obj id is '${e.id}'`));else throw new Error("There is no such as object you received in this flowchart!")}zoomTo(t){if(t<lo||t>co)return;this.logger.info("InnoFlowchart.zoomTo",`scale is changed to ${t}`),this.d3Div.node().__zoom.k=t,this.d3Container.attr("transform",`scale(${t})`);let e=`${1/t*100}%`;this.d3Grid.attr("transform",`scale(${t})`).attr("width",e).attr("height",e),this.updateSvgSize()}recordNewObjectsAction(...t){this._actionController.addAction(new nt(_t(t),this._iContainer)),this._updateNegativePos()}emitChangedStatus(){this._isChanged||(this._isChanged=!0,this.classedOnSvg(!0,"changed"))}getScale(){return this.getTransform().k}getSelectedConnections(t=!0){let e=[];for(let n of this._objectManager.getConnectionIterator())n.isSelected&&e.push(n);return t&&e.sort((n,i)=>n.temp.clickedSeq-i.temp.clickedSeq),e}_editObjProp(t){t.forEach(e=>{for(let n of e.propList)n.oldValue===void 0&&(n.oldValue=e.objData[n.key]),e.objData[n.key]=n.newValue}),this._actionController.addAction(new W(t,this._iContainer))}editSelectedObjProp(t,e){let n=[];for(let i of this._objectManager.getSelectedObjIterator())i.isSelected&&n.push(new V(i.data,[{key:t,newValue:e}]));this._editObjProp(n)}append(t,e){if(this._readonly){this.logger.info("InnoFlowchart.append()","Preventing append (readonly: true)");return}if(this._validateAppendMode({mode:t,data:e}))this.clearAppendMode(),this._appendMode.mode=t,this._appendMode.data=e,this.logger.info("InnoFlowchart.append()","Append Mode",this._appendMode.mode);else throw this.logger.error("InnoFlowchart.append()","Invalid append info!"),new Error("Invalid append info!")}resetScreen(){let t=this.d3Div.node();t.scrollLeft=0,t.scrollTop=0}getWrapperSize(){let t=this.d3Div.node();if(!t)throw new Error("there is no wrapper div");let{width:e,height:n}=t.getBoundingClientRect();return{width:e,height:n}}getTransform(){return ce(this.d3Div.node())}updateMinimumSvgSize(){let t=this.getWrapperSize();this._wrapperSize.width=parseInt(t.width),this._wrapperSize.height=parseInt(t.height),this.refreshSvgSize()}updateSvgSize(){let t=this.getTransform().k,e=Math.max(this._wrapperSize.width,this._svgSize.width*t),n=Math.max(this._wrapperSize.height,this._svgSize.height*t);this.d3Svg.attr("width",e).attr("height",n)}refreshSvgSize(){let t={maxX:0,maxY:0};for(let e of this._objectManager.getAllObjIterator())t.maxX=Math.max(t.maxX,e.endX),t.maxY=Math.max(t.maxY,e.endY);t.maxX+=this._wrapperSize.width/2,t.maxY+=this._wrapperSize.height/2,t.maxX=Math.max(this._wrapperSize.width,t.maxX),t.maxY=Math.max(this._wrapperSize.height,t.maxY),this._svgSize.width=t.maxX,this._svgSize.height=t.maxY,this.logger.info("InnoFlowchart.refreshSvgSize()",t),this.updateSvgSize()}render(){this.updateMinimumSvgSize()}getObjectList(){let t=[];for(let e of this._objectManager.getAllObjIterator())!e.isTempObj&&t.push(e);return t}clearActionList(){this.logger.info("InnoFlowchart.clearActionList()"),this._actionController.clear()}undoAction(){if(this._readonly){this.logger.info("InnoFlowchart.undoAction()","Preventing undo (readonly: true)");return}let t=this._actionController.undo();this.logger.debug("InnoFlowchart.undoAction()",t),t!==null&&(this.refreshSvgSize(),this.$emit(Y.UNDO,t))}redoAction(){if(this._readonly){this.logger.info("InnoFlowchart.redoAction()","Preventing redo (readonly: true)");return}let t=this._actionController.redo();this.logger.debug("InnoFlowchart.redoAction()",t),t!==null&&(this.refreshSvgSize(),this.$emit(Y.REDO,t))}_objectClickHandler(t,e){this.logger.info(`InnoFlowchart.event.emit.${e}`,t),t.select(!0),this.$emit(e,t)}_commonObserveCallback(t){switch(t.key){case"id":{let e=this.getObjectOrNull(t.oldValue);e!==null&&this._objectManager.reassignId(e,t.oldValue,t.newValue);break}case"isSelected":{t.newValue&&(t.renderObj.clickedSeq=this._seqMng.increaseClickSeq());break}default:break}}_connectionObserveCallback(t){let e=t.renderObj;switch(t.key){case"connection.sourceObjId":t.oldValue!==null&&t.newValue===null&&this.$emit(Y.DISCONNECT_NODE,e,t.key);break;case"connection.sourcePos":e.sourceObjId!==null&&this.$emit(Y.CONNECT_NODE,e,t.key);break;case"connection.destinationObjId":t.oldValue!==null&&t.newValue===null&&this.$emit(Y.DISCONNECT_NODE,e,t.key);break;case"connection.destinationPos":e.destinationObjId!==null&&this.$emit(Y.CONNECT_NODE,e,t.key);break;default:break}}_observerCallback(t){t.newValue!==t.oldValue&&(!this._isChanged&&!Xa.has(t.key)&&this.emitChangedStatus(),this._commonObserveCallback(t),t.renderObj.type==="connection"&&this._connectionObserveCallback(t))}_selectCallbackHandler(t,e,n){let i=this._objectManager.getParentGroupOrNull(t);if(e&&(this._moveScreenOnSelect&&t.type==="node"&&this.moveScreenByObject(t),this._singleSelection))for(let o of this._objectManager.getSelectedObjIterator())o!==t&&o.release();i!==null&&i.select(!1,n),this.logger.info("InnoFlowchart._selectCallbackHandler()",t),this.$emit(Y.SELECT_OBJECT,t)}_releaseCallbackHandler(t,e){this.$emit(Y.RELEASE_OBJECT,t)}_editTextModeCallback(){this._objMouseHandler.removeTooltipObj()}_getXYOnSheet(t,e){let n=1/this.getTransform().k;return{x:t*n,y:e*n}}_validateAppendMode({mode:t,data:e}){switch(t){case"append":return e.type==="node"||e.type==="connection";case"paste":return e.objects.length>0;default:return!1}}_getProperlyPointsToCreate(t){let e=t["connection.points"];t:for(;;){for(let n of this._objectManager.getConnectionIterator())if(n.comparePoints(e)){e.forEach(i=>{i.x+=10,i.y+=10});continue t}return e}}_getProperlyNodePosToCreate(t){let e=t["node.x"],n=t["node.y"];t:for(;;){for(let i of this._objectManager.getNodeIterator())if(i.x===e&&i.y===n){e+=10,n+=10;continue t}return{"node.x":e,"node.y":n}}}_initAppendObj(){switch(this._appendMode.data.type){case"node":{this._appendingObject=this.add(wt(q({},this._appendMode.data),{temp:!0,id:"appending_temp_obj",opacity:.5}));break}default:break}}_mouseMoveOnSheetHandler(t){let e=t.layerX,n=t.layerY;if(!!this._validateAppendMode(this._appendMode)){switch(this._appendMode.mode){case"append":this._appendingObject===null&&this._initAppendObj(),this._moveAppendingNode(e,n);break;default:break}this.d3Div.node().focus()}}_setZIndexOnSelected(t){let e=[],n=t==="front"?this._objectManager.getObjCount():0;this.logger.info("InnoFlowchart.setZIndex()",`new z-index = ${n}`);for(let i of this.getSelectedObjects())e.push({objId:i.id,oldValue:i.zIndex+(t==="back"?1:0),newValue:n}),i.zIndex=n;this.emitChangedStatus(),this._actionController.addAction(new be(e,this._iContainer))}bringToFront(){this.logger.info("InnoFlowchart.bringToFront()"),this._setZIndexOnSelected("front")}bringToBack(){this.logger.info("InnoFlowchart.bringToBack()"),this._setZIndexOnSelected("back")}_moveSelectedObjects(t,e){for(let n of this._objectManager.getSelectedObjIterator())n.moveTo(t,e)}getObjectOrNull(t){return this._objectManager.findOrNull(t)}selectObjectById(t){let e=this.getObjectOrNull(t);if(e!=null)e.select();else throw new Error(`Not found obj id '${t}'`)}_addCommonMouseAction(t){this._objMouseHandler.addMouseAction(t)}_isSingleSelection(t){return this._singleSelection||!t}_addClickActionOnNode(t){t.g.on("click",e=>{this._editMode||(this._isSingleSelection(e.ctrlKey)&&this.releaseAllObjects(t),this._objectClickHandler(t,Y.CLICK_NODE))}).on("dblclick",()=>{t.data.editable&&this._readonly===!1&&t.renderer.editLabelMode(),this.logger.info("InnoFlowchart.event.emit.dblClickNode",t),this.$emit(Y.DOUBLE_CLICK_NODE,t)})}classedOnSvg(t,...e){e.forEach(n=>this.d3Svg.classed(n,t)),this.$emit(Y.CHANGE_CLASS,this.d3Svg.attr("class"))}_addDragActionOnNode(t){let e=!1,n=0,i=0;t.g.call(K().filter(()=>this._editMode===!1).on("start",o=>{this._isSingleSelection(o.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=!1,n=o.x,i=o.y,t.select(!1)}).on("drag",o=>{if(this._readonly)return;let s=o.x-t.width/2,a=o.y-t.height/2,l=s-t.x,c=a-t.y;!e&&Math.abs(n-o.x)+Math.abs(i-o.y)>8&&(e=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-node-move")),e&&this._moveSelectedObjects(l,c)}).on("end",()=>{this._moveScreenOnSelect&&t.type==="node"&&this.moveScreenByObject(t),this._moveHandler.moveEndHandler(),this._terminateDrag("drag-node-move")}))}_addDragActionOnConnector(t){for(let e of t.renderer.connectors){let n=Wi(e.attr("class"));e.call(K().filter(()=>this._readonly===!1).on("start",i=>{let o=t.x+t.width/2+i.x,s=t.y+t.height/2+i.y,a=this._appendMode.data.render,l=t.getPositionXY(n);this._initDrag("drag-node-connector"),this._createAppendingConnection(l.x,l.y,o,s,{type:"connection",render:a,"connection.sourceObjId":t.id,"connection.sourcePos":n})}).on("drag",i=>{if(this._appendingObject===null)return;let o=t.x+t.width/2+i.x,s=t.y+t.height/2+i.y;this._appendMode.dragged=!0,this._moveAppendingConnection(o,s)}).on("end",()=>{this._appendingObject!==null&&(this._endAppendingConnection(),this._terminateDrag("drag-node-connector"))}))}}_addNodeEvent(t){this._addClickActionOnNode(t),this._addDragActionOnNode(t),this._addDragActionOnConnector(t),this._resizeHandler.addDragActionOnResizer(t)}_addClickActionOnConnection(t){t.g.on("click",e=>{this._isSingleSelection(e.ctrlKey)&&this.releaseAllObjects(t),this._objectClickHandler(t,"clickConnection")}),t.g.on("dblclick",()=>{t.data.editable&&this._readonly===!1&&t.renderer.editLabelMode(),this.logger.info("InnoFlowchart.event.emit.dblClickConnection",t),this.$emit(Y.DOUBLE_CLICK_CONNECTION,t)})}_addDragActionOnConnection(t){let e=0,n=0,i=!1;t.g.call(K().filter(()=>this._editMode===!1).on("start",o=>{this._isSingleSelection(o.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=o.x,n=o.y,i=!1,t.select()}).on("drag",o=>{if(this._readonly)return;let s=o.x-e,a=o.y-n;if(!i&&Math.abs(s)+Math.abs(a)>5&&(i=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-con-move")),!!i){if(t.sourceObjId!==null){let l=this.getObjectOrNull(t.sourceObjId);(l===null||l.isSelected===!1)&&(t.sourceObjId=null)}if(t.destinationObjId!==null){let l=this.getObjectOrNull(t.destinationObjId);(l===null||l.isSelected===!1)&&(t.destinationObjId=null)}this._moveSelectedObjects(s,a),e=o.x,n=o.y}}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-con-move")}))}_addDragActionOnConnectionConnector(t){let e=(n,i,o)=>K().filter(()=>this._editMode===!1&&this._readonly===!1).on("start",()=>{this._moveHandler.moveStartHandler(),this._initDrag("drag-con-connector")}).on("drag",s=>{let a=this._getNodeAndPosUnderXY(s.x,s.y,this._simpleConnectingMode),l=o==="start"?t.firstPoint:t.endPoint;a.node===null?(t[n]=null,t[i]=null,l.x=s.x,l.y=s.y):(t[n]=a.node.id,this._simpleConnectingMode?this._setShortestPosition(t):t[i]=a.pos),t.renderType==="elbow"&&t.renderer.refreshAdjustList(),t.render()}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-con-connector")});t.renderer.objects.sourceConnector.call(e("sourceObjId","sourcePos","start")),t.renderer.objects.destinationConnector.call(e("destinationObjId","destinationPos","end"))}_addConnectionEvent(t){this._addClickActionOnConnection(t),this._addDragActionOnConnection(t),this._addDragActionOnConnectionConnector(t)}_addGroupEvent(t){let e=!1,n=0,i=0,o=0,s=0;t.g.call(K().filter(()=>this._editMode===!1&&this._readonly===!1).on("start",a=>{this._isSingleSelection(a.sourceEvent.ctrlKey)&&!t.isSelected&&this.releaseAllObjects(t),e=!1,n=a.x,i=a.y,o=a.x,s=a.y,t.select()}).on("drag",a=>{!e&&Math.abs(n-a.x)+Math.abs(i-a.y)>8&&(e=!0,this._moveHandler.moveStartHandler(),this._initDrag("drag-group-move")),e&&(this._moveSelectedObjects(a.x-o,a.y-s),o=a.x,s=a.y)}).on("end",()=>{this._moveHandler.moveEndHandler(),this._terminateDrag("drag-group-move")}))}_addObjectEvent(t){switch(this._addCommonMouseAction(t),t.type){case"node":this._addNodeEvent(t),t.render();break;case"connection":this._addConnectionEvent(t);break;case"group":this._addGroupEvent(t);break;default:throw new Error(`Unknown data type '${t.type}'`)}}_initDrag(t){this._appendMode.dragged=!1,this._objMouseHandler.removeTooltipObj(),this.classedOnSvg(!0,t)}_terminateDrag(t){this._appendMode.dragged=!1,this.classedOnSvg(!1,t),this.clearAppendMode(),this._updateNegativePos(),this.refreshSvgSize(),this._simpleConnectingMode&&this.updateShortestNodes()}_updateNegativePos(){let t={x:0,y:0,objX:null,objY:null};for(let e of this._objectManager.getAllObjIterator())e.startX<t.x&&(t.x=e.startX,t.objX=e),e.startY<t.y&&(t.y=e.startY,t.objY=e);if(t.x<0||t.y<0){let e=this._actionController.popLastUndoAction(),n=[],i=t.x<0?-t.x:0,o=t.y<0?-t.y:0;for(let s of this._objectManager.getNodeIterator()){let a=new V(s.data,[]);a.addMoveOldValues(),s.moveTo(i,o),a.updateMoveNewValues(),n.push(a)}for(let s of this._objectManager.getConnectionIterator())if(s.sourceObj===null||s.destinationObj===null){let a=new V(s.data,[]);a.addMoveOldValues(),s.moveTo(i,o),a.updateMoveNewValues(),n.push(a)}for(let s of this._objectManager.getGroupIterator())s.render();e&&(e.unshift(new W(n,this._iContainer)),this._actionController.addAction(...e)),this.refreshSvgSize()}}getCountOfSelectedObject(){let t=0;for(let e of this._objectManager.getSelectedObjIterator())this._objectManager.getParentGroupOrNull(e)==null&&e.isSelected&&++t;return t}selectAllObjects(){if(!this._singleSelection)for(let t of this._objectManager.getAllObjIterator())t.type!=="group"&&t.select(!0)}releaseAllObjects(t){for(let e of this._objectManager.getAllObjIterator())t!==e&&e.release(!0)}align(t,e){let n=e||this.getSelectedNodes();if(!(n.length<=1)){switch(this._moveHandler.moveStartHandler(),t){case"left":{let i=n[0].x;n.forEach(o=>o.x=i);break}case"right":{let i=n[0].endX;n.forEach(o=>o.x=i-o.width);break}case"center":{let i=n[0].centerX;n.forEach(o=>o.x=i-o.width/2);break}case"top":{let i=n[0].y;n.forEach(o=>o.y=i);break}case"bottom":{let i=n[0].endY;n.forEach(o=>o.y=i-o.height);break}case"middle":{let i=n[0].centerY;n.forEach(o=>o.y=i-o.height/2);break}default:throw new Error(`Unknown direct '${t}'`)}this._moveHandler.moveEndHandler()}}distribute(t,e){let n=e||this.getSelectedNodes(!1);if(n.length<=1)return;let i=t==="h"?{start:"x",center:"centerX",end:"endX",size:"width"}:{start:"y",center:"centerY",end:"endY",size:"height"};n.sort((c,h)=>c[i.center]-h[i.center]),this._moveHandler.moveStartHandler();let o=n.length-1,s=n[0][i.end],a=n[o][i.start],l=n.slice(1,o).reduce((c,h)=>c-h[i.size],a-s)/o;n.slice(1,o).reduce((c,h)=>(h[i.start]=c,c+h[i.size]+l),s+l),this._moveHandler.moveEndHandler()}getSelectedObjects(t=!0){let e=Array.from(this._objectManager.getSelectedObjIterator());return t&&e.sort((n,i)=>n.temp.clickedSeq-i.temp.clickedSeq),e}removeSelected(){let t=this.getSelectedObjects(!1);t.forEach(e=>this.remove(e)),this._actionController.addAction(new Xt(_t(t),this._iContainer))}_getChildElementOrNull(t){let e=this.d3Container.node();return t>=e.children.length?null:e.children[t]}_getNodeAndPosUnderXY(t,e,n=!1){for(let i of this._objectManager.getNodeIterator())if(!!i.isConnectorEnabled)if(n){if(new Yt(i.x,i.y,i.endX,i.endY).isContained(t,e))return{node:i,pos:"left"}}else for(let o of Cr){let s=i.getPositionXY(o);if(new Yt(s.x-Sr,s.y-Sr,s.x+Sr,s.y+Sr).isContained(t,e))return{node:i,pos:o}}return{node:null,pos:null}}moveSelectedNode(t,e){for(let n of this._objectManager.getNodeIterator())n.isSelected&&(n.x=parseInt((n.x+t)/5)*5,n.y=parseInt((n.y+e)/5)*5)}getSelectedNodes(t=!0){let e=[];for(let n of this._objectManager.getNodeIterator())n.isSelected&&e.push(n);return t&&e.sort((n,i)=>n.clickedSeq-i.clickedSeq),e}getNodeConnections(t){let e=t.observeProperties?t.id:t,n=this.getObjectOrNull(e),i=Array.from(this._objectManager.getConnectedConnections(e));return i.sort((o,s)=>Zr(n,o)-Zr(n,s)),i}moveScreenByObject(t){let e=this.getTransform().k;this.d3Div.node().scrollLeft=t.centerX*e-this._wrapperSize.width/2,this.d3Div.node().scrollTop=t.centerY*e-this._wrapperSize.height/2}clearAppendMode(){this._appendingObject!==null&&this.remove(this._appendingObject),this._appendMode.mode=null,this._appendMode.data=null,this._appendMode.dragged=!1,this._appendingObject=null}_getClipInfo(){let t=[];for(let e of this._objectManager.getSelectedObjIterator())e.type==="group"&&(e.data.objectList=Array.from(e.objectSet)),t.push(e.data);return{copyDateTime:new Date,objects:t}}cut(){return vt(this,null,function*(){this.logger.info("InnoFlowchart.cut()"),this.getSelectedObjects().length!==0&&(yield vr.saveData(JSON.stringify(this._getClipInfo())),this.removeSelected())})}copy(){return vt(this,null,function*(){this.logger.info("InnoFlowchart.copy()"),yield vr.saveData(JSON.stringify(this._getClipInfo()))})}_createPastingObjs(t){let e=new Map,n=0,i=this._seqMng.getObjSeqId(),o=[];t.objects.forEach(s=>{if(this.getObjectOrNull(s.id)!==null){let a=i+n;for(;this.getObjectOrNull(a)!==null||this.getObjectOrNull(a)!==null&&this.getObjectOrNull(a).type==="connection"&&(this.getObjectOrNull(a).sourceObjId===a||this.getObjectOrNull(a).destinationObjId===a);)a=i+ ++n,this.logger.info("id",a);++n,e.set(s.id,a)}else e.set(s.id,s.id)}),t.objects.forEach(s=>{let a=e.get(s.id);switch(s.type){case"node":{let l=this._getProperlyNodePosToCreate(s);o.push(this.add(wt(q(q({},s),l),{id:a,isSelected:!1,isHovered:!1})));break}case"connection":{let l=this._getProperlyPointsToCreate(s);s["connection.sourceObjId"]!=null&&s["connection.sourceObjId"]!=null&&e.has(s["connection.sourceObjId"])&&(s["connection.sourceObjId"]=e.get(s["connection.sourceObjId"])),s["connection.destinationObjId"]!=null&&s["connection.destinationObjId"]!=null&&e.has(s["connection.destinationObjId"])&&(s["connection.destinationObjId"]=e.get(s["connection.destinationObjId"])),o.push(this.add(wt(q({},s),{id:a,isSelected:!1,points:l})));break}case"group":{o.push(this.add(wt(q({},s),{id:a,isSelected:!1,objectList:s.objectList.map(l=>e.get(l))})));break}default:throw new Error(`Not supported type '${s.type}'`)}}),this.moveScreenByObject(o[0]),this.releaseAllObjects(),o.forEach(s=>{s.select()}),this._actionController.addAction(new nt(_t(o),this._iContainer))}paste(){return vt(this,null,function*(){if(this._editMode||this._appendMode.mode!=null){this.logger.debug("InnoFlowchart.paste()","Could not paste because of edit or append mode");return}this.logger.info("InnoFlowchart.paste()"),this._createPastingObjs(JSON.parse(yield vr.loadData()))})}fitSizeOnText(){this.logger.info("InnoFlowchart.fitSizeOnText()"),this._resizeHandler.resizeDragStart(),this.getSelectedNodes(!1).forEach(t=>{t.resizerEnabled&&t.fitSizeOnText()}),this._resizeHandler.resizeDragEnd()}_getShortestPositions(t,e){let n={dist:Number.MAX_VALUE,sourcePos:"",destinationPos:""};for(let i of Cr)for(let o of Cr){let s=t.getPositionXY(i),a=e.getPositionXY(o),l=Jr(s,a);l<n.dist&&(n.dist=l,n.sourcePos=i,n.destinationPos=o)}return n}_setShortestPosition(t){let e=this.getObjectOrNull(t.sourceObjId),n=this.getObjectOrNull(t.destinationObjId),i=t.sourcePos,o=t.destinationPos;if(e!==null&&n!==null){let s=this._getShortestPositions(e,n);t.editProp(()=>{t.sourcePos=s.sourcePos,t.destinationPos=s.destinationPos})}else if(e===null){let s=t.firstPoint;t.destinationPos=this._getPositionOnSimpleConnecting(s,n)}else{let s=t.endPoint;t.sourcePos=this._getPositionOnSimpleConnecting(s,e)}if(i!==t.sourcePos||o!==t.destinationPos){let s=new V(t.data,[{key:"connection.sourcePos",oldValue:i,newValue:t.sourcePos},{key:"connection.destinationPos",oldValue:o,newValue:t.destinationPos}]);this._actionController.addAction(new W([s],this._iContainer))}}updateShortestConnections(){this.logger.info("InnoFlowchart.updateShortestConnections()");for(let t of this._objectManager.getConnectionIterator())t.isSelected&&this._setShortestPosition(t)}updateShortestNodes(){let t=[];for(let e of this._objectManager.getNodeIterator())if(e.isSelected!==!1)for(let n of this._objectManager.getConnectedConnections(e.id))t.indexOf(n)===-1&&t.push(n);t.forEach(e=>this._setShortestPosition(e))}_getPositionOnSimpleConnecting(t,e){let n={dist:Number.MAX_VALUE,pos:null};for(let i of Cr){let o=e.getPositionXY(i),s=Jr(o,t);s<n.dist&&(n.dist=s,n.pos=i)}return n.pos}selectType(t){this.logger.info("InnoFlowchart.selectType()",t);let e=t.toLowerCase();this.releaseAllObjects();for(let n of this._objectManager.getAllObjIterator())n.renderType===e&&n.select(!1,e)}clearChangedStatus(){this._isChanged&&(this._isChanged=!1,this.classedOnSvg(!1,"changed"))}clear(){this.clearAppendMode();for(let t of this._objectManager.getAllObjIterator())t.destroy();this._objectManager.clear(),this._seqMng.clear(),this._actionController.clear()}group(t=void 0){let e=t||{};e.type="group",e.render="group",e.objectList=[],Qr(e,this.theme);for(let i of this._objectManager.getSelectedObjIterator())e.objectList.push(i.id);let n=this.add(e);n.resize(),n.select(),this._actionController.addAction(new nt(_t([n]),this._iContainer))}ungroup(){let t=[];for(let e of this._objectManager.getGroupIterator())e.isSelected&&(e.clear(),t.push(e),this.remove(e));this._actionController.addAction(new Xt(_t(t),this._iContainer))}_moveAppendingNode(t,e){let n=this._getXYOnSheet(t,e);this._appendingObject.x=n.x-this._appendingObject.width/2,this._appendingObject.y=n.y-this._appendingObject.height/2}_getSvgXYOnDrag(t,e,n=!1){let i={x:t+this.d3Div.node().scrollLeft,y:e+this.d3Div.node().scrollTop};if(n){let o=this.getTransform(),s=1/o.k;i.x*=s,i.y*=s}return i}_dragStartHandlerOnSelection(t){let e=this._getSvgXYOnDrag(t.x,t.y);this.selection.rect=this.d3Svg.append("rect").attr("class","selection"),this.selection.startX=e.x,this.selection.startY=e.y}_dragHandlerOnSelection(t){let e=this._getSvgXYOnDrag(t.x,t.y),n=Math.min(e.x,this.selection.startX),i=Math.min(e.y,this.selection.startY),o=Math.max(e.x,this.selection.startX),s=Math.max(e.y,this.selection.startY);this.selection.rect.attr("x",n).attr("y",i).attr("width",o-n).attr("height",s-i)}_dragEndHandlerOnSelection(t){try{let e=this.getTransform(),n=this._getSvgXYOnDrag(t.x,t.y),i=Math.min(n.x,this.selection.startX),o=Math.min(n.y,this.selection.startY),s=Math.max(n.x,this.selection.startX),a=Math.max(n.y,this.selection.startY),l=(c,h,p,f)=>c>=i&&h>=i&&c<=s&&h<=s&&p>=o&&f>=o&&p<=a&&f<=a;this._isSingleSelection(t.sourceEvent.ctrlKey)&&this.releaseAllObjects();for(let c of this._objectManager.getNodeIterator()){let h=c.x*e.k,p=(c.x+c.width)*e.k,f=c.y*e.k,m=(c.y+c.height)*e.k;l(h,p,f,m)&&c.select(!0)}for(let c of this._objectManager.getConnectionIterator()){let h=c.firstPoint,p=c.endPoint,f=Math.min(h.x,p.x)*e.k,m=Math.max(h.x,p.x)*e.k,S=Math.min(h.y,p.y)*e.k,k=Math.max(h.y,p.y)*e.k;l(f,m,S,k)&&c.select(!0)}}finally{this.selection.rect.remove(),this.selection.rect=null,this.$emit(Y.MOUSEUP_SHEET,this._getSvgXYOnDrag(t.x,t.y))}}_createAppendObj(){switch(this._appendMode.mode){case"append":{let t=this.add(q({"node.x":this._appendingObject.x,"node.y":this._appendingObject.y},this._appendMode.data));this._actionController.addAction(new nt(_t([t]),this._iContainer));break}default:break}this.clearAppendMode()}_dragController(t){if(this._appendMode.mode===null)switch(t.type){case"start":this._dragStartHandlerOnSelection(t);break;case"drag":this._dragHandlerOnSelection(t);break;case"end":this._dragEndHandlerOnSelection(t);break;default:break}else if(this._appendMode.mode==="append")if(this._appendMode.data.type==="node")switch(t.type){case"drag":this._moveAppendingNode(t.x,t.y);break;case"end":this._createAppendObj();break;default:break}else switch(t.type){case"start":{let e=this._getSvgXYOnDrag(t.x,t.y,!0);this._createAppendingConnection(e.x,e.y,e.x,e.y,this._appendMode.data),this._appendMode.dragged=!1;break}case"drag":{let e=this._getSvgXYOnDrag(t.x,t.y,!0);this._moveAppendingConnection(e.x,e.y,this._appendingObject.renderType),this._appendMode.dragged=!0;break}case"end":this._endAppendingConnection(),this.clearAppendMode();break;default:break}}cancelCreatingConnection(){if(this._appendingObject===null)throw new Error("There is no creatingConnection obj");this.clearAppendMode()}_changeObjRender(t,e){this._renderManager.changeRender(t,e,this._iContainer),this._addObjectEvent(t)}changeRender(t,e){let n=t.renderType;this._changeObjRender(t,e),this._actionController.addAction(new xe(t,n,e,this._iContainer))}_editTextCallbackHandler(t,e,n){this.logger.debug("InnoFlowchart._editTextCallbackHandler()",`oldText = '${e}'`,`newText = '${n}'`),this._actionController.addAction(new W([new V(t,[{key:"text",oldValue:e,newValue:n}])],this._iContainer))}_moveAppendingConnection(t,e){let n=this._getNodeAndPosUnderXY(t,e,this._simpleConnectingMode);n.node===null||n.node.id===this._appendingObject.sourceObjId?(this._appendingObject.setLastPointXY(t,e),this._appendingObject.destinationObjId=null,this._appendingObject.destinationPos=null):(this._appendingObject.destinationObjId=n.node.id,this._simpleConnectingMode?this.setShortestPosition(this._appendingObject):this._appendingObject.destinationPos=n.pos)}_adjDragCallbackHandler(t,e,n){this.logger.debug("InnoFlowchart.adjDragCallbackHandler()","record undo action"),this._actionController.addAction(new W([new V(t,[{key:"connection.points",oldValue:e,newValue:n}])],this._iContainer)),this._updateNegativePos()}_renderCallBack(t){if(t.type==="node"){let n=new Set;for(let i of this._objectManager.getConnectionIterator())!n.has(i.id)&&(i.sourceObjId===t.id||i.destinationObjId===t.id)&&(n.add(i.id),i.render())}let e=this._objectManager.getParentGroupOrNull(t);e!==null&&e.resize()}_clickOnSheetHandler(t){this.$emit(Y.CLICK,this._getXYOnSheet(t.layerX,t.layerY))}_createAppendingConnection(t,e,n,i,o){if(this._appendingObject!==null)throw new Error("Already created an appending obj!!");if(!o["connection.sourceObjId"]){let a=this._getNodeAndPosUnderXY(t,e);a.node!==null&&(o["connection.sourceObjId"]=a.node.id,o["connection.sourcePos"]=a.pos)}let s=wt(q({},o),{id:"#temp_appending_connection",type:"connection",opacity:.5,temp:!0,"connection.points":[{x:t,y:e},{x:n,y:i}]});this._appendingObject=this.add(s)}_endAppendingConnection(){let t=this._appendingObject.data;this._appendMode.dragged===!1&&(t=Gi(this._appendingObject));let e=this.add(wt(q({},t),{id:void 0,temp:!1,opacity:1}));this._actionController.addAction(new nt(_t([e]),this._iContainer))}handleKeydownF2(){if(!this._editMode&&this.getCountOfSelectedObject()===1)for(let t of this._objectManager.getSelectedObjIterator()){t.editLabel();return}}handleKeydownDelete(){this.removeSelected()}handleKeydownArrows(t,e){let n=this.getSelectedObjects(!1);n.length>0?this.moveWrapper(()=>{n.filter(i=>i.isSelected).forEach(i=>i.moveTo(t,e))}):(this.div.scrollLeft+=t*2,this.div.scrollTop+=e*2)}handleKeydownEscape(){let t=this._appendMode,e=this._appendingObject;t.mode===null&&e!==null?(this.logger.info("InnoFlowchart.handleKeydownEscape()","Cancel Creating Connection"),this.cancelCreatingConnection()):t.mode!==null?(this.logger.info("InnoFlowchart.handleKeydownEscape()","Clear Appending Data"),this.clearAppendMode()):(this.logger.info("InnoFlowchart.handleKeydownEscape()","releaseAllObj"),this.releaseAllObjects())}};export{Y as EVENT_TYPE,ho as IRFlowchart};
//# sourceMappingURL=flowchart.js.map
